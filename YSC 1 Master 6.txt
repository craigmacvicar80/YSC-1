import React, { useState, useMemo, useEffect } from 'react';
import { 
  Search, 
  Calendar as CalendarIcon, 
  Bookmark, 
  MapPin, 
  Filter, 
  ChevronRight, 
  ChevronLeft,
  Clock, 
  CreditCard, 
  Award, 
  Globe, 
  X, 
  LayoutDashboard,
  LayoutGrid,
  ExternalLink, 
  BookMarked, 
  UserCircle, 
  Syringe, 
  Microscope, 
  Milestone, 
  Mail, 
  Gem, 
  ShoppingCart, 
  Zap, 
  ClipboardList, 
  PlusCircle, 
  TrendingUp, 
  FlaskConical, 
  Heart, 
  Briefcase, 
  Code, 
  Users, 
  MessageSquare, 
  Video, 
  FileText, 
  Edit, 
  Trash2, 
  Save, 
  Pencil, 
  Building2, 
  GraduationCap, 
  Activity, 
  ClipboardCheck, 
  UserCheck, 
  Ear, 
  Baby, 
  Bone, 
  Droplet, 
  Brain, 
  Minus, 
  ArrowRight, 
  Table, 
  List as ListIcon, 
  Info, 
  CheckCircle2, 
  Circle, 
  MoreHorizontal, 
  Share2, 
  Navigation, 
  Linkedin, 
  Youtube, 
  Instagram, 
  Pin, 
  Bell, 
  Menu, 
  Upload, 
  Paperclip, 
  Star, 
  Plus,
  ChevronUp,
  ChevronDown
} from 'lucide-react';

// --- DATA CONSTANTS ---

const INITIAL_EVENTS = [
  { id: 50, title: "ALSGBI Annual Scientific Meeting", organizer: "ALSGBI", type: "Conference", startDate: "2025-11-03", endDate: "2025-11-04", location: "London Stansted, UK", venue: "Radisson Blu Hotel", cost: "TBA", cpd: 12, status: "Past", url: "https://www.alsgbi.org/2025-alsgbi-asm/", description: "The premier event for laparoscopic, robotic, and technology-enhanced surgery in the UK.", category: "General" },
  { id: 51, title: "RCP Med+ 2025", organizer: "RCP London", type: "Conference", startDate: "2025-11-11", endDate: "2025-11-12", location: "London, UK", venue: "RCP Regent's Park", cost: "£300+", cpd: 12, status: "Past", url: "https://www.rcp.ac.uk/", description: "Essential clinical updates in acute, general and specialty medicine.", category: "Medicine" },
  { id: 801, title: "NOTSS (Non-Technical Skills)", organizer: "RCSEd", type: "Course", startDate: "2025-11-20", endDate: "2025-11-20", location: "Edinburgh, UK", venue: "RCSEd", cost: "£235", cpd: 6, status: "Past", url: "https://www.rcsed.ac.uk/", description: "Cognitive and interpersonal aspects of operative surgery.", category: "Safety" },
  { id: 101, title: "Masterclass in PPH Management", organizer: "RCOG", type: "Course", startDate: "2025-12-05", endDate: "2025-12-05", location: "London, UK", venue: "RCOG", cost: "£371", cpd: 4, status: "Open", url: "https://www.rcog.org.uk", description: "Management of Postpartum Haemorrhage.", category: "Obstetrics" },
  { id: 802, title: "Core Skills in Orthopaedics", organizer: "RCSEd", type: "Course", startDate: "2025-12-09", endDate: "2025-12-11", location: "Edinburgh, UK", venue: "RCSEd", cost: "£860", cpd: 18, status: "Full", url: "https://www.rcsed.ac.uk/", description: "Develops competence in junior orthopaedic procedures.", category: "Orthopaedics" },
  { id: 103, title: "ASiT Foundation Skills", organizer: "ASiT", type: "Course", startDate: "2025-12-13", endDate: "2025-12-13", location: "Manchester, UK", venue: "Manchester Surgical Centre", cost: "£150", cpd: 6, status: "Open", url: "https://asit.org", description: "Foundational course for early-stage trainees.", category: "Skills" },
  { id: 104, title: "Basic Surgical Skills (Edin)", organizer: "RCSEd", type: "Course", startDate: "2025-12-17", endDate: "2025-12-18", location: "Edinburgh, UK", venue: "RCSEd", cost: "£585", cpd: 12, status: "Full", url: "https://www.rcsed.ac.uk", description: "Core surgical skills: knot tying, suturing, tissue handling.", category: "Skills" },
  { id: 700, title: "SRS Annual Meeting 2026", organizer: "Surgical Research Society", type: "Conference", startDate: "2026-01-08", endDate: "2026-01-09", location: "London, UK", venue: "RCS England", cost: "TBA", cpd: 12, status: "Open", url: "https://surgicalresearch.org.uk/", description: "Premier forum for surgical research.", category: "Research" },
  { id: 803, title: "MRCS Part B OSCE Prep", organizer: "RCSEd", type: "Exam Prep", startDate: "2026-01-10", endDate: "2026-01-11", location: "Edinburgh, UK", venue: "RCSEd", cost: "£545", cpd: 12, status: "Full", url: "https://www.rcsed.ac.uk/", description: "Mock OSCE stations.", category: "Exam" },
  { id: 201, title: "Teach the Teacher", organizer: "RCSI", type: "Course", startDate: "2026-01-14", endDate: "2026-01-14", location: "Online", venue: "Virtual", cost: "€450", cpd: 6, status: "Open", url: "https://www.rcsi.com", description: "Development as a teacher and assessor.", category: "Education" },
  { id: 901, title: "Basic Surgical Skills (Glas)", organizer: "RCPSG", type: "Course", startDate: "2026-01-15", endDate: "2026-01-16", location: "Glasgow, UK", venue: "RCPSG", cost: "£580", cpd: 12, status: "Open", url: "https://rcpsg.ac.uk/", description: "Two-day intercollegiate course.", category: "Skills" },
  { id: 203, title: "Intro to Microsurgery", organizer: "Griffin Institute", type: "Course", startDate: "2026-01-20", endDate: "2026-01-22", location: "Harrow, UK", venue: "Griffin Institute", cost: "£1,250", cpd: 24, status: "Open", url: "https://griffininstitute.org.uk", description: "Microscope setup, dissection, anastomosis.", category: "Specialist" },
  { id: 206, title: "EAES Innovation Symposium", organizer: "EAES", type: "Symposium", startDate: "2026-01-22", endDate: "2026-01-24", location: "Porto, Portugal", venue: "TBA", cost: "TBA", cpd: 18, status: "Open", url: "https://eaes.eu/", description: "Innovation in surgery and robotics.", category: "Innovation" },
  { id: 805, title: "Core Skills in Laparoscopy", organizer: "RCS England", type: "Course", startDate: "2026-01-26", endDate: "2026-01-27", location: "London, UK", venue: "Bjorn Saven Centre", cost: "£945", cpd: 12, status: "Open", url: "https://www.rcseng.ac.uk/", description: "Standardised 2-day course for CT1/2.", category: "Skills" },
];

const HOSPITALS_DATA = [
    { name: "St Thomas' Hospital", location: "Lambeth, London", nation: "England", employer: "Guy's and St Thomas' NHS FT", type: "NHS", search_key: "Guy's and St Thomas'", specialties: ["Cardiac & Thoracic Surgery", "Transplant & Vascular Surgery", "Major Trauma", "Oncology"] },
    { name: "Guy's Hospital", location: "Southwark, London", nation: "England", employer: "Guy's and St Thomas' NHS FT", type: "NHS", search_key: "Guy's and St Thomas'", specialties: ["Urology", "Oncology (Cancer Centre)", "Dental & Maxillofacial", "Robotic Surgery"] },
    { name: "King's College Hospital", location: "Camberwell, London", nation: "England", employer: "King's College Hospital NHS FT", type: "NHS", search_key: "King's College Hospital", specialties: ["Neuroscience & Neurosurgery", "Major Trauma", "Liver/Hepatobiliary Surgery", "Transplant Surgery"] },
    { name: "St George's Hospital", location: "Tooting, London", nation: "England", employer: "St George's University Hospitals NHS FT", type: "NHS", search_key: "St George's University Hospitals", specialties: ["Neuroscience & Neurosurgery", "Cardiac Surgery", "Major Trauma", "Stroke Services"] },
    { name: "John Radcliffe Hospital", location: "Oxford", nation: "England", employer: "Oxford University Hospitals NHS FT", type: "NHS", search_key: "Oxford University Hospitals", specialties: ["Neuroscience", "Craniofacial Surgery", "Vascular Surgery", "Major Trauma"] },
    { name: "Addenbrooke's Hospital", location: "Cambridge", nation: "England", employer: "Cambridge University Hospitals NHS FT", type: "NHS", search_key: "Cambridge University Hospitals", specialties: ["Transplant Surgery", "Neurosurgery", "Plastics Surgery", "Major Trauma"] },
    { name: "Queen Elizabeth Hospital Birmingham", location: "Birmingham", nation: "England", employer: "University Hospitals Birmingham NHS FT", type: "NHS", search_key: "Birmingham Hospitals", specialties: ["Major Trauma", "Liver & Multi-Organ Transplant", "Neuroscience", "Cardiology"] },
    { name: "Leeds General Infirmary", location: "Leeds", nation: "England", employer: "Leeds Teaching Hospitals NHS Trust", type: "NHS", search_key: "Leeds Teaching Hospitals", specialties: ["Cardiac Surgery", "Neuroscience", "Major Trauma", "Transplant Surgery"] },
    { name: "Queen Elizabeth University Hospital", location: "Glasgow", nation: "Scotland", employer: "NHS Greater Glasgow and Clyde", type: "NHS", search_key: "NHS Greater Glasgow Clyde", specialties: ["Major Trauma", "Neuroscience", "Renal & Transplant Surgery", "Maxillofacial Surgery"] },
    { name: "University Hospital of Wales", location: "Cardiff", nation: "Wales", employer: "Cardiff and Vale UHB", type: "NHS", search_key: "Cardiff and Vale UHB", specialties: ["Major Trauma", "Neuroscience", "Transplant Surgery", "Cardiac Surgery"] },
    { name: "Royal Victoria Hospital", location: "Belfast", nation: "Northern Ireland", employer: "Belfast HSC Trust", type: "HSC", search_key: "Belfast Health Social Care Trust", specialties: ["Major Trauma", "Neuroscience", "Cardiothoracic Surgery", "Maxillofacial Surgery"] }
];

const MOCK_JOB_LISTINGS = [
    { id: 31, title: "RCS Eng Senior Clinical Fellow - Robotic Surgery", employer: "UCLH NHS FT", hospital: "University College Hospital", specialty: "Robotic Surgery", competition: "3.1:1", quality: "94%", deadline: "2026-03-20", link: "https://www.rcseng.ac.uk/careers-in-surgery/training-in-the-uk/fellowships/", badge: "Hot" },
    { id: 33, title: "BOA ST8 Trauma Fellowship", employer: "Imperial College Healthcare", hospital: "St Mary's Hospital", specialty: "Trauma & Orthopaedics", competition: "4.5:1", quality: "92%", deadline: "2026-03-15", link: "https://www.boa.ac.uk/careers-training/fellowships.html", badge: "New" },
    { id: 1, title: "ST3 General Surgery - London Deanery", employer: "Imperial College Healthcare", hospital: "St Mary's Hospital", specialty: "General Surgery", competition: "8.2:1", quality: "92%", deadline: "2025-12-15", link: "https://www.jobs.nhs.uk/candidate/search?keyword=Imperial%20College%20Healthcare", badge: "Closing Soon" },
    { id: 2, title: "ST3 Trauma & Orthopaedics", employer: "NHS Lothian", hospital: "Royal Infirmary of Edinburgh", specialty: "Trauma & Orthopaedics", competition: "12.5:1", quality: "88%", deadline: "2025-12-20", link: "https://apply.jobs.scot.nhs.uk/search-jobs/keywords/NHS%20Lothian" },
    { id: 18, title: "ST4 Neurosurgery Registrar", employer: "Northern Care Alliance", hospital: "Salford Royal Hospital", specialty: "Neuroscience", competition: "9.5:1", quality: "93%", deadline: "2026-01-15", link: "https://www.jobs.nhs.uk/candidate/search?keyword=Northern%20Care%20Alliance" },
    { id: 3, title: "Consultant Neurosurgeon", employer: "UHB NHS FT", hospital: "Queen Elizabeth Hospital", specialty: "Neuroscience", competition: "1.1:1", quality: "95%", deadline: "2026-01-10", link: "https://www.jobs.nhs.uk/candidate/search?keyword=Birmingham%20Hospitals" },
    { id: 4, title: "Registrar - Paediatric Cardiac", employer: "Guy's and St Thomas'", hospital: "Evelina London", specialty: "Congenital Cardiac", competition: "7.0:1", quality: "91%", deadline: "2025-12-30", link: "https://www.jobs.nhs.uk/candidate/search?keyword=Guy%27s%20and%20St%20Thomas%27" }
];

const JOB_PORTALS = {
    "NHS": "https://www.jobs.nhs.uk/candidate/search?keyword=",
    "HSC": "https://jobs.hscni.net/Search?keywords=",
    "SCOT": "https://apply.jobs.scot.nhs.uk/search-jobs/keywords/",
    "Nuffield Health": "https://www.nuffieldhealthcareers.com/job-search?query=",
    "Spire Healthcare": "https://www.spirehealthcare.com/recruitment/jobs/",
    "Priory Group": "https://www.priorygroup.com/careers/search-jobs",
    "BMI Healthcare": "https://jobs.bmichoice.co.uk/search-results?keywords=",
    "Kingsbridge Healthcare Group": "https://kingsbridgehealthcaregroup.com/careers/",
    "The London Clinic": "https://careers.thelondonclinic.co.uk/jobs"
};

const PREDEFINED_SKILLS = [
  "Suturing & Knot Tying", "Laparoscopy (Basic)", "Laparoscopy (Advanced)", "Endoscopy", 
  "Catheterization", "Cannulation", "Venepuncture", "Patient History Taking", 
  "Clinical Examination", "Team Leadership", "Communication", "Research Methods", 
  "Data Analysis", "Teaching & Mentoring", "Audit/QIP Methodology", 
  "Trauma Management (ATLS)", "Basic Life Support (BLS)", "Advanced Life Support (ALS)", 
  "Incision & Drainage", "Excision of Skin Lesion", "Appendicectomy", "Hernia Repair",
  "Robotic Surgery Console", "Microsurgery", "Endovascular Skills", "Fracture Fixation"
];

const GOAL_POINTS = 40;

const INITIAL_READINESS_SCORES = [
  { subject: 'Clinical', A: 9.0, fullMark: 10 },
  { subject: 'Research', A: 6.5, fullMark: 10 },
  { subject: 'Leadership', A: 8.2, fullMark: 10 },
  { subject: 'Teaching', A: 7.5, fullMark: 10 },
  { subject: 'Audit/QIP', A: 5.8, fullMark: 10 },
];

const CPD_GUIDELINES = [
    { category: "Operative Experience", items: [{ criteria: "Logbook: >120 cases/year (validated)", points: "8-10" }, { criteria: "Logbook: 80-120 cases/year", points: "5-7" }, { criteria: "Logbook: <80 cases/year", points: "0-4" }] },
    { category: "Publications", items: [{ criteria: "First author, PubMed-cited original research", points: "5 per paper (Max 10)" }, { criteria: "Co-author, PubMed-cited original research", points: "2 per paper" }, { criteria: "Case Report / Letter (PubMed cited)", points: "1 per item" }] },
    { category: "Presentations", items: [{ criteria: "National/International Oral Presentation", points: "5" }, { criteria: "National/International Poster", points: "2" }, { criteria: "Regional Oral Presentation", points: "2" }, { criteria: "Local/Departmental Presentation", points: "1" }] },
    { category: "Quality Improvement (Audit)", items: [{ criteria: "Closed loop audit (2 cycles), primary author", points: "8" }, { criteria: "Single cycle audit, primary author", points: "4" }, { criteria: "Participation in data collection only", points: "1" }] },
    { category: "Teaching & Training", items: [{ criteria: "Designed & delivered regional teaching programme", points: "8" }, { criteria: "Regular delivery of local teaching (>4 sessions)", points: "4" }, { criteria: "One-off teaching session", points: "1" }] },
    { category: "Courses & Qualifications", items: [{ criteria: "Postgraduate Degree (PhD/MD/MSc)", points: "6-10" }, { criteria: "Intercalated Degree (BSc/MRes)", points: "4" }, { criteria: "Core Courses (ATLS, CCrISP, BSS) - Pass", points: "Mandatory (0)" }, { criteria: "Additional relevant courses", points: "1 per course" }] }
];

const INITIAL_ACTIVITIES = [
  { id: 1, category: 'Publications', description: 'First author PubMed-cited paper', points: 5, date: '2020-01-15', summary: 'Research on hernia repair outcomes.', comments: 'Submitted to BJS.', file: 'paper.pdf' }, 
  { id: 2, category: 'Presentations', description: 'Oral Presentation at ASiT 2025', points: 3, date: '2025-10-14', summary: 'Presented audit findings.', comments: 'Well received.', file: 'presentation.pptx' }, 
  { id: 3, category: 'Quality Improvement (Audit)', description: 'Complete Audit Cycle on Antibiotic Prophylaxis', points: 8, date: '2025-11-01', summary: 'Two cycles completed.', comments: 'Closed loop.', file: 'audit.pdf' }, 
  { id: 4, category: 'Teaching & Training', description: 'Developed regional medical student teaching program', points: 5, date: '2025-11-05', summary: 'Series of 6 lectures.', comments: 'Positive feedback.', file: 'feedback.pdf' }, 
  { id: 5, category: 'Courses & Qualifications', description: 'Intercalated BSc (Hons) 1st Class', points: 7, date: '2025-12-01', summary: 'Anatomy and Human Biology', comments: '', file: 'certificate.jpg' }, 
  { id: 6, category: 'Prizes / Awards', description: 'Local Departmental Presentation Prize', points: 2, date: '2025-12-12', summary: 'Best presentation prize.', comments: '', file: 'prize.png' }, 
  { id: 7, category: 'Publications', description: 'Second author BJS letter', points: 1, date: '2025-12-15', summary: 'Letter to editor.', comments: '', file: 'letter.pdf' }, 
];

const MOCK_CASE_DATA = { totalCases: 145, essentialProceduresCompleted: 10, essentialProceduresTarget: 15 };
const MOCK_MENTOR_STATUS = { supervisor: "Dr. L. Carter", reviewDate: "2026-01-20", formStatus: "Pending Trainee Submission", alignmentScore: 78 };
const MOCK_PROFILE_DATA = {
    name: "Dr. Alex Chen", gmc: "7012345", level: "CT1 (Core Surgical Training)", specialtyInterest: "Cardiothoracic Surgery", startDate: "2025-08-01", email: "alex.chen@yoursurgicalcareer.com",
    employmentHistory: [
        { id: 1, role: "CT1 - Core Surgical Trainee", location: "London Deanery", period: "Aug 2024 - Present" },
        { id: 2, role: "Foundation Year 2 Doctor", location: "St. Thomas' Hospital", period: "Aug 22023 - Aug 2024" },
        { id: 3, role: "Foundation Year 1 Doctor", location: "King's College Hospital", period: "Aug 2022 - Aug 2023" },
    ],
    memberships: [{ id: 4, title: "Royal College of Surgeons of England (RCSeng)" }, { id: 5, title: "Association of Surgeons in Training (ASiT)" }],
    certifications: [{ id: 6, title: "Advanced Trauma Life Support (ATLS)", details: "Valid until 2026" }, { id: 7, title: "Basic Surgical Skills (BSS)", details: "Completed 2023" }],
    awards: [{ id: 8, title: "Distinction in Medical Finals", details: "University of Cambridge" }, { id: 9, title: "Local Departmental Presentation Prize", details: "Hospital Audit Day" }, { id: 10, title: "Diploma of Intercollegiate Membership", details: "Royal College of Surgeons (MRCS)" }],
    skills: {
      technical: [{ id: 1, name: "Laparoscopic Skills", level: 4, endorsers: 3 }, { id: 2, name: "Vascular Anastomosis", level: 3, endorsers: 1 }, { id: 3, name: "Suturing & Knot Tying", level: 5, endorsers: 8 }],
      nonTechnical: [{ id: 4, name: "Leadership", level: 5, endorsers: 6 }, { id: 5, name: "Patient Communication", level: 4, endorsers: 4 }]
    },
    evidence: [{ id: 1, title: "Outcomes of Robotic Hernia Repair", details: "Publication" }, { id: 2, title: "Laparoscopic Cholecystectomy - Demo", details: "Video" }, { id: 3, title: "QIP Cycle Summary (Signed)", details: "PDF" }]
};
const DASHBOARD_EVENTS = [{ title: "MRCS Part A Exam", date: "14 Jan 2026", type: "Exam" }, { title: "ATLS Recertification", date: "22 Mar 2026", type: "Training" }];
const MOCK_NETWORK = [{ initials: 'JD', name: 'Dr. Jane Doe', role: 'Consultant Plastic Surgeon', color: 'bg-emerald-500' }, { initials: 'RS', name: 'Mr. Raj Singh', role: 'ST7 Trauma & Orthopaedics', color: 'bg-indigo-500' }];

// --- HELPER COMPONENTS ---

function StatusBadge({ status }) {
  // FIX: Ensured the string literal for 'Full' is correctly terminated.
  const styles = { 
    Open: "bg-emerald-100 text-emerald-700 border-emerald-200", 
    Active: "bg-emerald-100 text-emerald-700 border-emerald-200", 
    Waitlist: "bg-amber-100 text-amber-700 border-amber-200", 
    Full: "bg-red-100 text-red-700 border-red-200", 
    Upcoming: "bg-blue-100 text-blue-700 border-blue-200", 
    Past: "bg-gray-100 text-gray-700 border-gray-200" 
  };
  return <span className={`px-2 py-0.5 rounded-full text-xs font-medium border ${styles[status] || styles.Open}`}>{status}</span>;
}

function TypeBadge({ type }) {
  const colors = { 
    Conference: "text-purple-600 bg-purple-50", 
    Course: "text-blue-600 bg-blue-50", 
    "Exam Prep": "text-indigo-600 bg-indigo-50", 
    Symposium: "text-pink-600 bg-pink-50", 
    Innovation: "text-orange-600 bg-orange-50", 
    Medicine: "text-teal-600 bg-teal-50", 
    Colorectal: "text-rose-600 bg-rose-50", 
    Orthopaedics: "text-cyan-600 bg-cyan-50", 
    Research: "text-gray-600 bg-gray-100", 
    Specialist: "text-fuchsia-600 bg-fuchsia-50", 
    ENT: "text-yellow-600 bg-yellow-50", 
    Transplant: "text-green-600 bg-green-50", 
    Vascular: "text-red-700 bg-red-50", 
    Neurosurgery: "text-indigo-800 bg-indigo-50", 
    HPB: "text-amber-600 bg-amber-50", 
    Breast: "text-pink-500 bg-pink-50", 
    "Hand Surgery": "text-blue-500 bg-blue-50", 
    Plastics: "text-violet-600 bg-violet-50", 
    Safety: "text-red-600 bg-red-50", 
    Student: "text-lime-600 bg-lime-50", 
    Cardiothoracic: "text-rose-700 bg-rose-50", 
    Paediatrics: "text-sky-600 bg-sky-50", 
    Maxillofacial: "text-slate-600 bg-slate-200", 
    Endocrine: "text-purple-700 bg-purple-50", 
    Education: "text-yellow-700 bg-yellow-50" 
  };
  return <span className={`px-2 py-1 rounded text-xs font-semibold ${colors[type] || "text-gray-600 bg-gray-50"}`}>{type}</span>;
}

function PlaceholderView({ title }) {
    return <div className="p-12 bg-white rounded-xl shadow-sm border border-gray-200 text-center"><h2 className="text-3xl font-bold text-slate-800 mb-4">{title}</h2><p className="text-gray-500">Content for this section is coming soon!</p></div>;
}

function DashboardMetric({ title, value, onClick }) {
    const valueColor = title.includes('Deadline') ? 'text-red-500' : 'text-blue-600';
    // FIX: Removed spreading interactionProps and applied onClick directly
    return (
        <div 
            onClick={() => onClick('portfolio')} 
            className="bg-white p-5 rounded-xl shadow-md border border-gray-100 flex flex-col justify-center h-full cursor-pointer hover:shadow-lg transition-shadow"
        >
            <p className="text-sm font-medium text-gray-500 mb-1">{title}</p>
            <p className={`text-3xl font-bold ${valueColor}`}>{value}</p>
        </div>
    );
}

function NetworkContact({ initials, name, role, color }) {
    return <div className="flex items-center gap-3 p-2 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer"><div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${color}`}>{initials}</div><div><p className="text-sm font-semibold text-slate-800">{name}</p><p className="text-xs text-gray-500">{role}</p></div></div>;
}

function UpcomingItem({ title, date, setActiveView }) {
    return <div className="flex items-start gap-3 p-2 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer border-t border-gray-100" onClick={() => setActiveView('events')}><CalendarIcon size={16} className="text-blue-500 mt-1 shrink-0" /><div><p className="text-sm font-medium text-slate-800">{title}</p><p className="text-xs text-blue-600 font-semibold">{date}</p></div></div>;
}

function MentorPanel({ supervisor, formStatus, alignmentScore, setActiveView }) {
    // FIX: Corrected unterminated string literal in styles object
    const statusStyles = {
        'Pending Trainee Submission': 'bg-red-100 text-red-600',
        'Submitted': 'bg-emerald-100 text-emerald-600'
    };
    const statusClass = statusStyles[formStatus] || 'bg-gray-100 text-gray-600';

    return <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100"><h3 className="text-lg font-semibold mb-3 border-b pb-2 text-slate-800">Mentorship & Alignment</h3><div className="space-y-3"><div className="flex justify-between text-sm"><span className="text-gray-500">Supervisor:</span><span className="font-semibold text-slate-800">{supervisor}</span></div><div className="flex justify-between text-sm"><span className="text-gray-500">Alignment:</span><span className={`font-bold ${alignmentScore > 75 ? 'text-emerald-600' : 'text-amber-500'}`}>{alignmentScore}%</span></div><div className="flex justify-between items-center text-sm pt-2 border-t border-gray-100"><span className="text-gray-500">Review Form:</span><span className={`font-semibold px-2 py-0.5 rounded text-xs ${statusClass}`}>{formStatus}</span></div><button className="mt-2 w-full text-center py-1.5 text-blue-600 hover:text-blue-800 text-sm font-medium transition-colors border-t border-dashed pt-3" onClick={() => setActiveView('portfolio')}><UserCheck size={16} className="inline mr-1" /> View Tasks</button></div></div>;
}

function CaseLogCard({ totalCases, completed, target, setActiveView }) {
    const color = completed >= target ? 'text-emerald-600' : 'text-orange-500';
    return <div className="bg-white p-5 rounded-xl shadow-md border border-gray-100 flex flex-col justify-center h-full cursor-pointer hover:shadow-lg transition-shadow" onClick={() => setActiveView('portfolio')}><p className="text-sm font-medium text-gray-500 mb-1">Case Log Summary</p><p className="text-3xl font-bold text-slate-900">{totalCases}</p><div className="flex items-center mt-1 gap-1 text-xs text-gray-600"><ClipboardCheck size={16} className={color} /><span className={`font-semibold ${color}`}>{completed}/{target} Essential</span></div></div>;
}

function CPDMatrixModal({ onClose }) {
    return <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full h-5/6 overflow-y-auto p-8"><div className="flex justify-between items-center border-b pb-4 mb-4"><h2 className="text-2xl font-bold text-slate-900 flex items-center gap-2"><Award className="text-blue-600"/> CPD Points Guide</h2><button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full"><X size={20}/></button></div><div className="overflow-x-auto"><table className="w-full text-sm text-left"><thead className="bg-gray-50 text-xs uppercase text-gray-500"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Criteria</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Points</th></tr></thead><tbody className="divide-y divide-gray-100">{CPD_GUIDELINES.map((section, idx) => (<React.Fragment key={idx}><tr className="bg-blue-50/50"><td colSpan="3" className="px-6 py-2 font-bold text-blue-800">{section.category}</td></tr>{section.items.map((item, i) => (<tr key={i}><td className="px-6 py-2"></td><td className="px-6 py-2">{item.criteria}</td><td className="px-6 py-2 text-right font-semibold">{item.points}</td></tr>))}</React.Fragment>))}</tbody></table></div></div></div>;
}

function AddItemModal({ category, onClose, onSave, initialData }) {
  const [formData, setFormData] = useState(initialData || {
    role: '', title: '', location: '', details: '', period: '', file: null,
    skillName: '', skillLevel: 0, description: '', points: 0, date: '', category: ''
  });

  useEffect(() => {
    if (initialData) {
        // Ensure that for skills, we use 'name' and 'level' if 'skillName' and 'skillLevel' aren't passed (for existing data structure)
        const data = {
            ...initialData,
            skillName: initialData.skillName || initialData.name || '',
            skillLevel: initialData.skillLevel || initialData.level || 0,
            category: initialData.category || ''
        };
        setFormData(data);
    }
  }, [initialData]);

  const handleChange = (e) => {
    const { name, value, files } = e.target;
    if (name === 'file') {
      setFormData(prev => ({ ...prev, file: files[0] }));
    } else {
      setFormData(prev => ({ ...prev, [name]: value }));
    }
  };

  const handleRating = (level) => {
    setFormData(prev => ({ ...prev, skillLevel: level }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    let newItem = { id: initialData ? initialData.id : Date.now() };
    
    if (category === 'Employment History') {
      newItem = { ...newItem, role: formData.role, location: formData.location, period: formData.period };
    } else if (category === 'Society Memberships') {
      newItem = { ...newItem, title: formData.title };
    } else if (category === 'Technical Skills') {
      newItem = { ...newItem, name: formData.skillName, level: formData.skillLevel, endorsers: formData.endorsers || 0 };
    } else if (category === 'Evidence') {
        newItem = { ...newItem, title: formData.title, details: formData.details || "Uploaded Document" };
    } else if (category === 'Activity') {
        // Ensure numerical conversion for points for Activity
        newItem = { ...newItem, description: formData.description, category: formData.category, points: parseInt(formData.points || 0), date: formData.date, summary: formData.summary || '', comments: formData.comments || '' };
    } else {
      newItem = { ...newItem, title: formData.title, details: formData.details };
    }

    if (formData.file) {
      newItem.evidence = formData.file.name;
    }

    onSave(category, newItem);
    onClose();
  };

  const currentLevel = formData.skillLevel || (initialData && initialData.level) || 0;

  return (
    <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fade-in">
      <div className="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 relative">
        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><X size={20} /></button>
        <h3 className="text-xl font-bold text-slate-800 mb-4">{initialData ? 'Edit' : 'Add'} {category}</h3>
        
        <form onSubmit={handleSubmit} className="space-y-4">
          {category === 'Employment History' && (
            <>
              <div>
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Role / Job Title</label>
                <input required name="role" value={formData.role} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. CT1 Surgery" />
              </div>
              <div>
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Hospital / Deanery</label>
                <input required name="location" value={formData.location} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. St Thomas' Hospital" />
              </div>
              <div>
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Period</label>
                <input required name="period" value={formData.period} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. Aug 2024 - Present" />
              </div>
            </>
          )} 

          {category === 'Technical Skills' && (
            <>
              <div>
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Skill Name</label>
                <input 
                  list="skill-options" 
                  required 
                  name="skillName" 
                  value={formData.skillName} 
                  onChange={handleChange} 
                  className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" 
                  placeholder="Select or type a skill..." 
                />
                <datalist id="skill-options">
                  {PREDEFINED_SKILLS.map(skill => <option key={skill} value={skill} />)}
                </datalist>
              </div>
              <div>
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-2">Proficiency Level (Self-Assessed)</label>
                <div className="flex gap-2">
                  {[1, 2, 3, 4, 5].map((star) => (
                    <button
                      key={star}
                      type="button"
                      onClick={() => handleRating(star)}
                      className={`transition-colors ${star <= currentLevel ? 'text-yellow-400 fill-yellow-400' : 'text-gray-300'}`}
                    >
                      <Star size={24} fill={star <= currentLevel ? "currentColor" : "none"} />
                    </button>
                  ))}
                </div>
                <p className="text-xs text-gray-500 mt-1">
                  {currentLevel === 1 && "Novice - Observed only"}
                  {currentLevel === 2 && "Beginner - Performed with supervision"}
                  {currentLevel === 3 && "Competent - Performed independently"}
                  {currentLevel === 4 && "Proficient - Able to teach others"}
                  {currentLevel === 5 && "Expert - Mastery level"}
                  {currentLevel === 0 && "Select a level"}
                </p>
              </div>
            </>
          )}

          {category === 'Activity' && (
              <>
                <div>
                    <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Description</label>
                    <input required name="description" value={formData.description} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. Published paper on..." />
                </div>
                <div>
                    <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Category</label>
                    <select required name="category" value={formData.category} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="">Select Category...</option>
                        {CPD_GUIDELINES.map(g => <option key={g.category} value={g.category}>{g.category}</option>)}
                        <option value="Prizes / Awards">Prizes / Awards</option> {/* Manually add Prizes */}
                        <option value="Leadership & Management">Leadership & Management</option> {/* Manually add Leadership */}
                    </select>
                </div>
                <div className="grid grid-cols-2 gap-4">
                    <div>
                        <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Date</label>
                        <input type="date" name="date" value={formData.date} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" />
                    </div>
                    <div>
                        <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Points</label>
                        <input type="number" name="points" value={formData.points} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" />
                    </div>
                </div>
              </>
          )}

          {category !== 'Employment History' && category !== 'Technical Skills' && category !== 'Activity' && (
            <>
              <div>
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Title / Name</label>
                <input required name="title" value={formData.title} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder={`e.g. ${category === 'Society Memberships' ? 'Royal College of Surgeons' : category === 'Evidence' ? 'Research Paper Title' : 'ATLS Course'}`} />
              </div>
              {category !== 'Society Memberships' && (
                <div>
                  <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">{category === 'Evidence' ? 'Type / Description' : 'Details / Date'}</label>
                  <input name="details" value={formData.details} onChange={handleChange} className="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder={category === 'Evidence' ? 'e.g. Publication, Video, Letter' : 'e.g. Valid until 2028'} />
                </div>
              )}
            </>
          )}

          {category !== 'Activity' && (
              <div className="pt-2">
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Evidence (Optional)</label>
                <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors cursor-pointer relative">
                <input type="file" name="file" onChange={handleChange} className="absolute inset-0 opacity-0 cursor-pointer" />
                {formData.file ? (
                    <div className="flex items-center justify-center gap-2 text-blue-600 text-sm font-medium">
                    <FileText size={16} /> {formData.file.name}
                    </div>
                ) : (
                    <div className="text-gray-400 text-xs flex flex-col items-center gap-1">
                    <Upload size={20} />
                    <span>Click to upload certificate or letter</span>
                    </div>
                )}
                </div>
              </div>
          )}

          <button type="submit" className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 rounded-lg transition-colors mt-2">
            {initialData ? 'Update' : 'Add'} {category === 'Activity' ? 'Activity' : 'Item'}
          </button>
        </form>
      </div>
    </div>
  );
}

function ActivityDetailModal({ activity, onClose, onSave }) {
    const [data, setData] = useState({ 
        summary: activity.summary || '', 
        comments: activity.comments || '' 
    });

    const handleChange = (e) => {
        setData(prev => ({ ...prev, [e.target.name]: e.target.value }));
    };

    const handleSave = () => {
        onSave(activity.id, data);
        onClose();
    };

    return (
        <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fade-in">
            <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8 relative flex flex-col gap-6 max-h-[90vh] overflow-y-auto">
                <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><X size={24} /></button>
                
                <div>
                    <div className="flex items-center gap-3 mb-2">
                        <span className="px-2.5 py-0.5 rounded-full text-xs font-bold bg-blue-100 text-blue-700 uppercase tracking-wide">{activity.category}</span>
                        <span className="text-gray-500 text-sm font-medium">{activity.date}</span>
                    </div>
                    <h2 className="text-2xl font-bold text-slate-900">{activity.description}</h2>
                    <div className="mt-2 text-emerald-600 font-bold flex items-center gap-1">
                        <TrendingUp size={16} /> +{activity.points} Points
                    </div>
                </div>

                {activity.file && (
                    <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-white rounded-lg border border-gray-200 text-blue-600">
                                <FileText size={20} />
                            </div>
                            <div>
                                <p className="text-sm font-semibold text-slate-800">{activity.file}</p>
                                <p className="text-xs text-gray-500">Attached Evidence</p>
                            </div>
                        </div>
                        <button className="text-sm text-blue-600 font-medium hover:underline">Download</button>
                    </div>
                )}

                <div className="space-y-4">
                    <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Summary</label>
                        <textarea 
                            name="summary" 
                            value={data.summary} 
                            onChange={handleChange} 
                            rows={4} 
                            className="w-full p-3 border border-gray-300 rounded-lg text-sm text-slate-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none"
                            placeholder="Summarize this activity..."
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-bold text-slate-700 mb-2">Reflective Comments</label>
                        <textarea 
                            name="comments" 
                            value={data.comments} 
                            onChange={handleChange} 
                            rows={4} 
                            className="w-full p-3 border border-gray-300 rounded-lg text-sm text-slate-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none"
                            placeholder="Reflect on what you learned..."
                        />
                    </div>
                </div>

                <div className="flex justify-end pt-4 border-t border-gray-100">
                    <button onClick={handleSave} className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-bold transition-colors shadow-sm">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    );
}


function EditableList({ items, icon, title, type, onAdd, onDelete, onEdit, onEditActivity, className = '' }) {
    return (
      <div className={`bg-white p-5 rounded-xl border border-gray-200 shadow-sm h-full flex flex-col ${className}`}>
        <div className="flex justify-between items-center border-b border-gray-100 pb-3 mb-4">
            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">{icon} {title}</h3>
            {onAdd && (
                <button onClick={onAdd} className="text-blue-600 hover:text-blue-800 transition-colors bg-blue-50 p-1.5 rounded-full hover:bg-blue-100">
                    <PlusCircle size={20} />
                </button>
            )}
        </div>
        
        <div className="space-y-3 flex-1 overflow-y-auto custom-scrollbar">
        {items.length === 0 ? (
            // Add a dedicated placeholder for an empty list
            <p className="text-sm text-gray-400 italic text-center py-8">No items added yet. Click <PlusCircle size={14} className="inline-block" /> to add one.</p>
        ) : (
            items.map((item, idx) => (
              <div 
                key={item.id || idx} 
                className="flex justify-between items-start group p-3 rounded-lg border border-gray-100 hover:border-gray-200 hover:bg-gray-50 transition-colors"
                onClick={() => onEditActivity && onEditActivity(item)} // Handle activity selection
              >
                <div className={type === 'pill' ? "flex items-center justify-between w-full mr-2" : "flex flex-col w-full"}>
                  {type === 'pill' ? (
                    <>
                        <div className="flex items-center gap-2">
                            <span className="font-medium text-slate-700">{item.name}</span>
                            {item.evidence && <Paperclip size={12} className="text-blue-500" />}
                        </div>
                        <div className="flex gap-0.5">
                            {[...Array(5)].map((_, i) => (
                                <Star key={i} size={12} className={i < item.level ? "fill-yellow-400 text-yellow-400" : "text-gray-200"} />
                            ))}
                        </div>
                    </>
                  ) : (
                    <>
                      <div className="flex items-center justify-between w-full">
                           <div className="flex items-center gap-2">
                              <p className="text-sm font-semibold text-slate-800">{item.role || item.title}</p>
                              {item.evidence && <Paperclip size={14} className="text-blue-500" title={`Evidence: ${item.evidence}`} />}
                           </div>
                      </div>
                      <p className="text-xs text-gray-500 mt-1">{item.location || item.details} {item.period ? `| ${item.period}` : ''}</p>
                    </>
                  )}
                </div>
                {/* Control buttons only visible on hover */}
                <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity self-center ml-2 shrink-0" onClick={(e) => e.stopPropagation()}>
                  <button onClick={() => onEdit && onEdit(item)} className="text-gray-400 hover:text-blue-600"><Pencil size={14} /></button>
                  <button onClick={() => onDelete && onDelete(item.id)} className="text-gray-400 hover:text-red-500"><Trash2 size={14} /></button>
                </div>
              </div>
            ))
        )}
        </div>
      </div>
    );
}

function RadarChart({ data }) {
  const size = 200;
  const center = size / 2;
  const radius = (size / 2) - 30; // Padding
  const levels = 4;
  
  const angleToPoint = (angle, value) => {
    const x = center + radius * value * Math.cos(angle - Math.PI / 2);
    const y = center + radius * value * Math.sin(angle - Math.PI / 2);
    return { x, y };
  };

  const totalAxes = data.length;
  const angleSlice = (Math.PI * 2) / totalAxes;

  const gridLevels = Array.from({ length: levels }).map((_, i) => {
    const levelFactor = (i + 1) / levels;
    const points = data.map((_, index) => {
      const angle = index * angleSlice;
      const { x, y } = angleToPoint(angle, levelFactor);
      return `${x},${y}`;
    }).join(" ");
    return <polygon key={i} points={points} fill="none" stroke="#e2e8f0" strokeWidth="1" />;
  });

  const dataPoints = data.map((d, index) => {
    const angle = index * angleSlice;
    const { x, y } = angleToPoint(angle, d.A / d.fullMark);
    return `${x},${y}`;
  }).join(" ");

  const axes = data.map((d, index) => {
    const angle = index * angleSlice;
    const { x, y } = angleToPoint(angle, 1);
    const labelPoint = angleToPoint(angle, 1.25);
    
    return (
      <g key={index}>
        <line x1={center} y1={center} x2={x} y2={y} stroke="#e2e8f0" strokeWidth="1" />
        <text 
          x={labelPoint.x} 
          y={labelPoint.y} 
          textAnchor="middle" 
          dominantBaseline="middle" 
          className="text-[10px] fill-slate-500 font-medium uppercase tracking-wider"
        >
          {d.subject}
        </text>
      </g>
    );
  });

  return (
    <div className="flex items-center justify-center py-2">
      <svg width="100%" height="100%" viewBox={`0 0 ${size} ${size}`} className="max-w-[280px]">
        {gridLevels}
        {axes}
        <polygon points={dataPoints} fill="rgba(37, 99, 235, 0.2)" stroke="#2563eb" strokeWidth="2" />
        {data.map((d, index) => {
          const angle = index * angleSlice;
          const { x, y } = angleToPoint(angle, d.A / d.fullMark);
          return <circle key={index} cx={x} cy={y} r="3" className="fill-blue-600" />
        })}
      </svg>
    </div>
  );
}

// --- VIEW COMPONENTS ---

function ContactView() {
  const contactLinks = [
    { name: "Email", value: "contact@yoursurgicalcareer.com", icon: <Mail size={20} className="text-white" />, bg: "bg-blue-500", link: "mailto:contact@yoursurgicalcareer.com" },
    { name: "LinkedIn", value: "Your Surgical Career Professional", icon: <Linkedin size={20} className="text-white" />, bg: "bg-[#0077b5]", link: "#" },
    { name: "Instagram", value: "@YourSurgicalCareer", icon: <Instagram size={20} className="text-white" />, bg: "bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500", link: "#" },
    { name: "YouTube", value: "Surgical Training Channel", icon: <Youtube size={20} className="text-white" />, bg: "bg-[#FF0000]", link: "#" },
    { name: "Pinterest", value: "Surgical Resources", icon: <Pin size={20} className="text-white" />, bg: "bg-[#E60023]", link: "#" },
  ];

  return (
    <div className="p-4 md:p-8 bg-white rounded-xl shadow-sm border border-gray-200 max-w-3xl mx-auto mt-4 animate-fade-in">
       <div className="text-center mb-8">
         <h2 className="text-3xl font-bold text-slate-900 mb-2">Get in Touch</h2>
         <p className="text-gray-500">Connect with us on social media or send us an email.</p>
       </div>

       <div className="grid gap-4">
         {contactLinks.map((item) => (
           <a 
             key={item.name} 
             href={item.link}
             target="_blank"
             rel="noopener noreferrer"
             className="flex items-center p-4 rounded-xl border border-gray-100 hover:border-gray-300 hover:shadow-md transition-all group bg-gray-50 hover:bg-white"
           >
             <div className={`w-10 h-10 rounded-full flex items-center justify-center shadow-sm shrink-0 ${item.bg}`}>
               {item.icon}
             </div>
             <div className="ml-4 flex-1">
               <h3 className="text-sm font-bold text-slate-800">{item.name}</h3>
               <p className="text-sm text-gray-600 group-hover:text-blue-600 transition-colors">{item.value}</p>
             </div>
             <div className="text-gray-300 group-hover:text-blue-600 transition-colors">
               <ExternalLink size={18} />
             </div>
           </a>
         ))}
       </div>

       <div className="mt-8 p-6 bg-blue-50 rounded-xl border border-blue-100 text-center">
         <h3 className="font-bold text-blue-800 mb-2">Need Support?</h3>
         <p className="text-sm text-blue-700 mb-4">Our support team is available Monday to Friday, 9am - 5pm.</p>
         <button className="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold text-sm hover:bg-blue-700 transition-colors shadow-sm shadow-blue-200">
            Contact Support
         </button>
       </div>
    </div>
  );
}

function DashboardView({ totalPoints, activitiesCount, setActiveView }) {
    const progress = Math.round((totalPoints / GOAL_POINTS) * 100);
    const trendIcon = <TrendingUp size={16} className="text-emerald-500" />;
    
    // Logic to calculate progress style for the circle
    const circumference = 2 * Math.PI * 80; // Radius 80
    const offset = circumference - (progress / 100) * circumference;

    return (
        <div className="space-y-6 animate-fade-in">
            <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                <DashboardMetric title="Total Portfolio Points" value={totalPoints} onClick={setActiveView} />
                <div className="bg-white p-5 rounded-xl shadow-md border border-gray-100 flex flex-col justify-center h-full cursor-pointer hover:shadow-lg transition-shadow" onClick={() => setActiveView('portfolio')}><p className="text-sm font-medium text-gray-500 mb-1">Activities Logged</p><p className="text-3xl font-bold text-blue-600">{activitiesCount}</p><div className="flex items-center mt-1 gap-1 text-xs text-gray-600">{trendIcon}<span>+2 this month</span></div></div>
                <CaseLogCard totalCases={MOCK_CASE_DATA.totalCases} completed={MOCK_CASE_DATA.essentialProceduresCompleted} target={MOCK_CASE_DATA.essentialProceduresTarget} setActiveView={setActiveView} />
                <DashboardMetric title="Specialty Alignment" value={`${MOCK_MENTOR_STATUS.alignmentScore}%`} onClick={setActiveView} />
                <DashboardMetric title="Next Critical Deadline" value="ST3 Apps: 29 Nov" onClick={setActiveView} />
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-white p-6 rounded-xl shadow-md border border-gray-100 flex flex-col items-center justify-center text-center cursor-pointer hover:shadow-lg transition-shadow" onClick={() => setActiveView('portfolio')}>
                        <h3 className="text-lg font-semibold mb-6 text-slate-800">Progress to Competitive Goal (40pts)</h3>
                        {/* Progress Ring */}
                        <div className="relative w-48 h-48 flex items-center justify-center">
                            <svg className="w-full h-full transform -rotate-90" viewBox="0 0 200 200">
                                <circle
                                    className="text-gray-100"
                                    strokeWidth="10"
                                    stroke="currentColor"
                                    fill="transparent"
                                    r="80"
                                    cx="100"
                                    cy="100"
                                />
                                <circle
                                    className="text-blue-600 transition-all duration-500 ease-in-out"
                                    strokeWidth="10"
                                    strokeDasharray={circumference}
                                    strokeDashoffset={offset}
                                    strokeLinecap="round"
                                    stroke="currentColor"
                                    fill="transparent"
                                    r="80"
                                    cx="100"
                                    cy="100"
                                />
                            </svg>
                            <span className="absolute text-4xl font-bold text-blue-600">
                                {progress}%
                            </span>
                        </div>
                        {/* End Progress Ring */}
                        <p className="mt-6 text-sm text-gray-600 max-w-xs">You are currently at **{totalPoints}** points. You need 40 points for a competitive ST3 application.</p>
                    </div>
                    <div className="bg-white p-6 rounded-xl shadow-md border border-gray-100 flex flex-col items-center cursor-pointer hover:shadow-lg transition-shadow" onClick={() => setActiveView('portfolio')}>
                         <h3 className="text-lg font-semibold mb-2 text-slate-800">Portfolio Readiness</h3>
                         <div className="w-full h-full min-h-[250px] flex items-center justify-center">
                             <RadarChart data={INITIAL_READINESS_SCORES} />
                         </div>
                    </div>
                </div>
                <div className="lg:col-span-1 space-y-6">
                    <MentorPanel supervisor={MOCK_MENTOR_STATUS.supervisor} formStatus={MOCK_MENTOR_STATUS.formStatus} alignmentScore={MOCK_MENTOR_STATUS.alignmentScore} setActiveView={setActiveView} />
                    <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100"><h3 className="text-lg font-semibold mb-3 border-b pb-2 text-slate-800">My Network</h3><div className="space-y-1">{MOCK_NETWORK.map(c => <NetworkContact key={c.initials} {...c} />)}</div></div>
                    <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100"><h3 className="text-lg font-semibold mb-1 border-b pb-2 text-slate-800">Upcoming Events</h3><div className="space-y-1">{DASHBOARD_EVENTS.map(e => <UpcomingItem key={e.title} {...e} setActiveView={setActiveView} />)}</div></div>
                </div>
            </div>
        </div>
    );
}

function PortfolioView({ activities, setActivities, profileData, setProfileData }) {
    const [isProfileEditing, setIsProfileEditing] = useState(false);
    const [editFormData, setEditFormData] = useState(profileData);
    const [showCPDModal, setShowCPDModal] = useState(false);
    
    // Updated state to track category and specific item being edited
    const [activeModalCategory, setActiveModalCategory] = useState(null);
    const [itemToEdit, setItemToEdit] = useState(null);
    const [selectedActivity, setSelectedActivity] = useState(null);

    const handleSaveProfile = () => { setProfileData(editFormData); setIsProfileEditing(false); };
    const handleProfileChange = (e) => setEditFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));
    
    const openAddModal = (category) => {
        setItemToEdit(null); // Clear editing item for new add
        setActiveModalCategory(category);
    };

    const openEditModal = (category, item) => {
        setItemToEdit(item);
        setActiveModalCategory(category);
    };

    const handleSaveItem = (category, item) => {
        const keyMap = {
            'Employment History': 'employmentHistory',
            'Society Memberships': 'memberships',
            'Certificates': 'certifications',
            'Awards & Diplomas': 'awards',
            'Technical Skills': 'technicalSkills',
            'Evidence': 'evidence',
            'Activity': 'activity'
        };

        if (category === 'Activity') {
             setActivities(prev => {
               const exists = prev.find(i => i.id === item.id);
               if (exists) return prev.map(i => i.id === item.id ? item : i);
               return [...prev, item];
             });
             return;
        }
        
        if (category === 'Technical Skills') {
             setProfileData(prev => {
               const list = prev.skills.technical;
               const exists = list.find(i => i.id === item.id);
               const updatedList = exists ? list.map(i => i.id === item.id ? item : i) : [...list, item];
               return { ...prev, skills: { ...prev.skills, technical: updatedList } };
             });
        } else {
            const stateKey = keyMap[category];
            if (stateKey) {
                setProfileData(prev => ({
                    ...prev,
                    [stateKey]: item.id
                        ? prev[stateKey].map(i => i.id === item.id ? item : i)
                        : [...prev[stateKey], item]
                }));
            }
        }
    };

    const handleDeleteItem = (category, id) => {
          if (category === 'Activity') {
              setActivities(prev => prev.filter(i => i.id !== id));
              return;
          }

          if (category === 'Technical Skills') {
             setProfileData(prev => ({
                 ...prev,
                 skills: {
                     ...prev.skills,
                     technical: prev.skills.technical.filter(item => item.id !== id)
                 }
             }));
          } else {
              const keyMap = {
                 'Employment History': 'employmentHistory',
                 'Society Memberships': 'memberships',
                 'Certificates': 'certifications',
                 'Awards & Diplomas': 'awards',
                 'Evidence': 'evidence'
              };
              const stateKey = keyMap[category];
              if (stateKey) {
                  setProfileData(prev => ({
                      ...prev,
                      [stateKey]: prev[stateKey].filter(item => item.id !== id)
                  }));
              }
          }
    };

    const handleSaveActivityDetails = (id, updatedData) => {
        setActivities(prev => prev.map(a => a.id === id ? { ...a, ...updatedData } : a));
    };

    // Helper to calculate total points for the badge
    const totalPoints = activities.reduce((sum, act) => sum + act.points, 0);

    return (
        <div className="space-y-6 animate-fade-in">
            {showCPDModal && <CPDMatrixModal onClose={() => setShowCPDModal(false)} />}
            {activeModalCategory && (
                <AddItemModal 
                    category={activeModalCategory} 
                    initialData={itemToEdit}
                    onClose={() => setActiveModalCategory(null)} 
                    onSave={handleSaveItem} 
                />
            )}
            {selectedActivity && (
                <ActivityDetailModal 
                    activity={selectedActivity} 
                    onClose={() => setSelectedActivity(null)} 
                    onSave={handleSaveActivityDetails} 
                />
            )}
            
            {/* 1. Profile Header */}
            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative flex flex-col md:flex-row items-start justify-between gap-6">
                <div className="flex items-center gap-5 w-full">
                    <div className="w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-full flex items-center justify-center text-white text-3xl font-bold shrink-0">
                        {profileData.name.split(' ').map(n => n[0]).join('')}
                    </div>
                    <div className="flex-1">
                        {/* Name/Level Edit Section */}
                        {isProfileEditing ? (
                            <input type="text" name="name" value={editFormData.name} onChange={handleProfileChange} className="text-2xl font-bold p-1 rounded border mb-1 block w-full max-w-xs" />
                        ) : (
                            <h3 className="text-2xl font-bold text-slate-900">{profileData.name}</h3>
                        )}
                        {isProfileEditing ? (
                            <input type="text" name="level" value={editFormData.level} onChange={handleProfileChange} className="text-sm font-semibold p-1 rounded border block w-full max-w-xs" />
                        ) : (
                            <p className="text-sm text-blue-600 font-semibold bg-blue-50 inline-block px-2 py-0.5 rounded-md mt-1">{profileData.level}</p>
                        )}
                        
                        {/* Detailed Info Edit Section */}
                        <div className="grid grid-cols-1 sm:grid-cols-3 gap-x-8 gap-y-2 mt-4 text-sm text-gray-500">
                             <div>
                                 <span className="uppercase text-[10px] font-bold tracking-wider text-gray-400 block">GMC No.</span>
                                 {isProfileEditing ? (
                                     <input type="text" name="gmc" value={editFormData.gmc} onChange={handleProfileChange} className="font-medium text-slate-700 p-1 rounded border w-full text-sm" />
                                 ) : (
                                     <span className="font-medium text-slate-700">{profileData.gmc}</span>
                                 )}
                             </div>
                             <div>
                                 <span className="uppercase text-[10px] font-bold tracking-wider text-gray-400 block">Training Start</span>
                                 {isProfileEditing ? (
                                     <input type="date" name="startDate" value={editFormData.startDate} onChange={handleProfileChange} className="font-medium text-slate-700 p-1 rounded border w-full text-sm" />
                                 ) : (
                                     <span className="font-medium text-slate-700">{new Date(profileData.startDate).toLocaleDateString('en-GB')}</span>
                                 )}
                             </div>
                             <div>
                                 <span className="uppercase text-[10px] font-bold tracking-wider text-gray-400 block">Interest</span>
                                 {isProfileEditing ? (
                                     <input type="text" name="specialtyInterest" value={editFormData.specialtyInterest} onChange={handleProfileChange} className="font-medium text-slate-700 p-1 rounded border w-full text-sm" />
                                 ) : (
                                     <span className="font-medium text-slate-700">{profileData.specialtyInterest}</span>
                                 )}
                             </div>
                        </div>
                    </div>
                </div>
                <div className="self-end md:self-start mt-4 md:mt-0 flex flex-col items-end gap-2 shrink-0">
                    <button onClick={isProfileEditing ? handleSaveProfile : () => setIsProfileEditing(true)} className="text-xs bg-white border border-gray-300 text-slate-600 px-3 py-1.5 rounded-lg font-medium shadow-sm hover:bg-gray-50 hover:text-slate-900 transition-colors">
                        {isProfileEditing ? 'Save Changes' : 'Edit Profile'}
                    </button>
                    {/* Total Points Badge */}
                    <div className="flex items-center gap-2 bg-emerald-50 text-emerald-800 font-bold px-3 py-1 rounded-lg border border-emerald-200">
                        <Award size={14} />
                        <span className="text-sm">{totalPoints} Points</span>
                    </div>
                </div>
            </div>
            
            {/* CPD GUIDE BUTTON */}
            <div className="flex justify-end">
                <button 
                  onClick={() => setShowCPDModal(true)} 
                  className="text-sm font-semibold bg-blue-600 text-white px-4 py-2.5 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition-colors shadow-md shadow-blue-200"
                >
                  <Award size={16} /> View CPD Points Guide
                </button>
            </div>
            
            {/* 2. Employment and Key Details (50% + 50% split) */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                
                {/* 2.1 Employment History (50% width on desktop) */}
                <EditableList 
                    items={profileData.employmentHistory} 
                    title="Employment History" 
                    icon={<Building2 size={18}/>} 
                    onAdd={() => openAddModal('Employment History')} 
                    onEdit={(item) => openEditModal('Employment History', item)}
                    onDelete={(id) => handleDeleteItem('Employment History', id)}
                />
                
                {/* 2.2 Key Details (50% width on desktop) */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6"> 
                    <EditableList 
                        items={profileData.memberships} 
                        title="Memberships" 
                        icon={<Users size={16}/>} 
                        onAdd={() => openAddModal('Society Memberships')}
                        onEdit={(item) => openEditModal('Society Memberships', item)}
                        onDelete={(id) => handleDeleteItem('Society Memberships', id)}
                    />
                    <EditableList 
                        items={profileData.certifications} 
                        title="Certificates" 
                        icon={<FileText size={16}/>} 
                        onAdd={() => openAddModal('Certificates')}
                        onEdit={(item) => openEditModal('Certificates', item)}
                        onDelete={(id) => handleDeleteItem('Certificates', id)}
                    />
                    {/* Awards span 2 columns on mobile/desktop for height balancing the entire right block */}
                    <div className="md:col-span-2">
                        <EditableList
                            items={profileData.awards}
                            title="Awards & Diplomas"
                            icon={<Award size={16} />}
                            onAdd={() => openAddModal('Awards & Diplomas')}
                            onEdit={(item) => openEditModal('Awards & Diplomas', item)}
                            onDelete={(id) => handleDeleteItem('Awards & Diplomas', id)}
                        />
                    </div>
                </div>
            </div>

            {/* 3. Skills and Evidence (50% + 50% split) */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* 3.1 Skills (50% width on desktop) */}
                <EditableList 
                    items={profileData.skills.technical} 
                    title="Technical Skills" 
                    icon={<Code size={18}/>} 
                    type="pill" 
                    onAdd={() => openAddModal('Technical Skills')}
                    onEdit={(item) => openEditModal('Technical Skills', item)}
                    onDelete={(id) => handleDeleteItem('Technical Skills', id)}
                />
                {/* 3.2 Evidence (50% width on desktop) */}
                <EditableList
                    items={profileData.evidence}
                    title="Evidence Uploads"
                    icon={<Briefcase size={18}/>}
                    onAdd={() => openAddModal('Evidence')}
                    onEdit={(item) => openEditModal('Evidence', item)}
                    onDelete={(id) => handleDeleteItem('Evidence', id)}
                />
            </div>
            
            {/* 4. Activity Log Section (Full Width) */}
            <div className="pt-4">
                <div className="flex justify-between items-center mb-4">
                    <div className="flex items-center gap-4">
                        <h3 className="text-xl font-bold text-slate-800">Portfolio Activity Log</h3>
                    </div>
                    <button 
                        onClick={() => openAddModal('Activity')}
                        className="bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold text-sm hover:bg-emerald-700 transition-colors shadow-sm flex items-center gap-2"
                    >
                        <PlusCircle size={16} /> Log Activity
                    </button>
                </div>
                <div className="space-y-3">
                    {activities.sort((a, b) => new Date(b.date) - new Date(a.date)).map(a => (
                        <div key={a.id} className="p-4 bg-gray-50 rounded-lg border border-gray-200 flex justify-between items-center group hover:bg-white transition-colors cursor-pointer" onClick={() => setSelectedActivity(a)}>
                            <div>
                                <p className="font-semibold text-slate-800">{a.description}</p>
                                <p className="text-sm text-gray-500">{a.category} | {a.date}</p>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="font-bold text-emerald-600 block shrink-0">+{a.points} pts</span>
                                <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity" onClick={(e) => e.stopPropagation()}>
                                    <button onClick={(e) => {e.stopPropagation(); openEditModal('Activity', a);}} className="text-gray-400 hover:text-blue-600"><Pencil size={14} /></button>
                                    <button onClick={(e) => {e.stopPropagation(); handleDeleteItem('Activity', a.id);}} className="text-gray-400 hover:text-red-500"><Trash2 size={14} /></button>
                                </div>
                            </div>
                        </div>
                    ))}
                    {activities.length === 0 && <p className="text-gray-400 italic text-center py-4">No activities logged yet.</p>}
                </div>
            </div>
        </div>
    );
}

function ExternalJobsView() {
  const [activeTab, setActiveTab] = useState('listings');
  const [selectedHospital, setSelectedHospital] = useState(null);
  const [listingFilters, setListingFilters] = useState({ title: '', hospital: '', specialty: 'All' });
  const [finderFilters, setFinderFilters] = useState({ name: '', location: '', nation: 'All', specialty: 'All' });

  const hospitalSpecialties = useMemo(() => {
    const set = new Set();
    HOSPITALS_DATA.forEach(h => h.specialties?.forEach(s => set.add(s)));
    return Array.from(set).sort();
  }, []);

  const jobSpecialties = useMemo(() => {
    const set = new Set();
    MOCK_JOB_LISTINGS.forEach(j => set.add(j.specialty));
    return Array.from(set).sort();
  }, []);

  const filteredListings = MOCK_JOB_LISTINGS.filter(job => {
    const matchesTitle = job.title.toLowerCase().includes(listingFilters.title.toLowerCase());
    const matchesHospital = job.hospital.toLowerCase().includes(listingFilters.hospital.toLowerCase()) || 
                            job.employer.toLowerCase().includes(listingFilters.hospital.toLowerCase());
    const matchesSpecialty = listingFilters.specialty === 'All' || job.specialty === listingFilters.specialty;
    return matchesTitle && matchesHospital && matchesSpecialty;
  });

  const filteredHospitals = HOSPITALS_DATA.filter(hospital => {
    const matchesName = hospital.name.toLowerCase().includes(finderFilters.name.toLowerCase()) || 
                        hospital.employer.toLowerCase().includes(finderFilters.name.toLowerCase());
    const matchesLocation = hospital.location.toLowerCase().includes(finderFilters.location.toLowerCase());
    const matchesNation = finderFilters.nation === 'All' || hospital.nation === finderFilters.nation;
    const matchesSpecialty = finderFilters.specialty === 'All' || hospital.specialties?.includes(finderFilters.specialty);
    return matchesName && matchesLocation && matchesNation && matchesSpecialty;
  });

  const getJobLink = (hospital) => {
    const isPrivate = hospital.type === 'Private';
    let baseUrl = '';
    let searchKey = '';

    if (isPrivate) {
        if (JOB_PORTALS[hospital.employer]) {
            baseUrl = JOB_PORTALS[hospital.employer];
            if (hospital.employer === "Nuffield Health" || hospital.employer === "BMI Healthcare") {
                searchKey = hospital.location;
            } else if (hospital.employer === "Spire Healthcare" || hospital.employer === "Priory Group" || hospital.employer === "The London Clinic" || hospital.employer === "Kingsbridge Healthcare Group") {
                searchKey = '';
            }
        } else {
            return 'https://www.google.com/search?q=' + encodeURIComponent(hospital.employer + ' ' + hospital.location + ' careers');
        }
    } else if (hospital.nation === 'Scotland') {
        baseUrl = JOB_PORTALS.SCOT;
        searchKey = hospital.search_key;
    } else if (hospital.nation === 'Northern Ireland') {
        baseUrl = JOB_PORTALS.HSC;
        searchKey = hospital.search_key;
    } else { // England & Wales
        baseUrl = JOB_PORTALS.NHS;
        searchKey = hospital.search_key;
    }
    return searchKey ? baseUrl + encodeURIComponent(searchKey) : baseUrl;
  };

  return (
    <div className="space-y-6 animate-fade-in bg-white rounded-xl shadow-sm border border-gray-200 min-h-[80vh] overflow-hidden flex flex-col">
      
      {/* Header */}
      <div className="px-8 pt-8 pb-4 bg-white border-b border-gray-100">
        <div className="flex justify-between items-start">
            <div>
                <h1 className="text-3xl font-extrabold text-slate-900 mb-2">Job Hunt</h1>
                <p className="text-gray-500">Find competitive training posts and explore UK hospitals.</p>
            </div>
            <div className="flex bg-gray-100 p-1 rounded-lg">
                <button 
                    onClick={() => setActiveTab('listings')}
                    className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === 'listings' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
                >
                    Training Posts
                </button>
                <button 
                    onClick={() => setActiveTab('finder')}
                    className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${activeTab === 'finder' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
                >
                    Hospital Directory
                </button>
            </div>
        </div>
      </div>

      <div className="p-4 md:p-8 pt-6 flex-1 bg-gray-50/50">
        {/* LISTINGS TAB */}
        {activeTab === 'listings' && (
            <div className="space-y-6">
                {/* Filters */}
                <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div className="relative">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
                        <input 
                            type="text" 
                            placeholder="Search job title..." 
                            className="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                            value={listingFilters.title}
                            onChange={(e) => setListingFilters({...listingFilters, title: e.target.value})}
                        />
                    </div>
                    <input 
                        type="text" 
                        placeholder="Search hospital..." 
                        className="px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                        value={listingFilters.hospital}
                        onChange={(e) => setListingFilters({...listingFilters, hospital: e.target.value})}
                    />
                    <select 
                        className="px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all md:col-span-2"
                        value={listingFilters.specialty}
                        onChange={(e) => setListingFilters({...listingFilters, specialty: e.target.value})}
                    >
                        <option value="All">Filter by Specialty (All)</option>
                        {jobSpecialties.map(s => <option key={s} value={s}>{s}</option>)}
                    </select>
                </div>

                {/* List */}
                <div className="grid gap-4">
                    {filteredListings.length === 0 ? (
                        <div className="text-center p-12 text-gray-400">No job listings match your search criteria.</div>
                    ) : (
                        filteredListings.map(job => (
                            <div key={job.id} className="bg-white p-5 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all flex flex-col md:flex-row justify-between gap-6 group">
                                <div className="flex gap-4">
                                    <div className="w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-lg shrink-0">
                                        {job.employer.substring(0, 2).toUpperCase()}
                                    </div>
                                    <div>
                                        <div className="flex items-center gap-2 mb-1">
                                            <a href={job.link} target="_blank" rel="noreferrer" className="text-lg font-bold text-slate-900 hover:text-blue-600 transition-colors">{job.title}</a>
                                            {job.badge && <span className={`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase tracking-wide ${job.badge === 'Hot' ? 'bg-orange-100 text-orange-600' : job.badge === 'New' ? 'bg-emerald-100 text-emerald-600' : 'bg-red-100 text-red-600'}`}>{job.badge}</span>}
                                        </div>
                                        <p className="text-sm text-gray-500 mb-3">{job.employer} • <span className="font-medium text-gray-700">{job.hospital}</span></p>
                                        <div className="flex flex-wrap gap-2 text-xs font-medium">
                                            <span className="bg-blue-50 text-blue-700 px-2.5 py-1 rounded-md border border-blue-100">{job.specialty}</span>
                                            <span className="bg-gray-100 text-gray-700 px-2.5 py-1 rounded-md border border-gray-200">Comp: {job.competition}</span>
                                            <span className="bg-gray-100 text-gray-700 px-2.5 py-1 rounded-md border border-gray-200">Deadline: {job.deadline}</span>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center">
                                    <a href={job.link} target="_blank" rel="noreferrer" className="w-full md:w-auto px-6 py-2.5 bg-slate-900 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors text-sm shadow-sm">
                                        View Details
                                    </a>
                                </div>
                            </div>
                        ))
                    )}
                </div>
            </div>
        )}

        {/* FINDER TAB */}
        {activeTab === 'finder' && (
            <div className="h-full flex flex-col space-y-6">
                    {/* Filters */}
                    <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input 
                            type="text" 
                            placeholder="Search Hospital Name" 
                            className="px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                            value={finderFilters.name}
                            onChange={(e) => setFinderFilters({...finderFilters, name: e.target.value})}
                        />
                        <input 
                            type="text" 
                            placeholder="Location (e.g. London)" 
                            className="px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                            value={finderFilters.location}
                            onChange={(e) => setFinderFilters({...finderFilters, location: e.target.value})}
                        />
                        <select 
                            className="px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                            value={finderFilters.nation}
                            onChange={(e) => setFinderFilters({...finderFilters, nation: e.target.value})}
                        >
                            <option value="All">All Nations</option>
                            <option value="England">England</option>
                            <option value="Scotland">Scotland</option>
                            <option value="Wales">Wales</option>
                            <option value="Northern Ireland">Northern Ireland</option>
                        </select>
                        <select 
                            className="px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                            value={finderFilters.specialty}
                            onChange={(e) => setFinderFilters({...finderFilters, specialty: e.target.value})}
                        >
                            <option value="All">All Specialties</option>
                            {hospitalSpecialties.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1 min-h-0">
                        {/* Hospital List */}
                        <div className="lg:col-span-2 border border-gray-200 rounded-xl bg-white overflow-hidden flex flex-col h-[500px] lg:h-auto shadow-sm">
                            <div className="overflow-y-auto p-2 custom-scrollbar flex-1 space-y-1">
                                {filteredHospitals.length === 0 ? (
                                    <div className="p-8 text-center text-gray-400">No hospitals match your criteria.</div>
                                ) : (
                                    filteredHospitals.map((hospital, idx) => (
                                        <div 
                                            key={idx}
                                            onClick={() => setSelectedHospital(hospital)}
                                            className={`p-4 rounded-lg cursor-pointer transition-all border ${selectedHospital?.name === hospital.name ? 'bg-blue-50 border-blue-200 ring-1 ring-blue-100' : 'bg-white border-transparent hover:bg-gray-50 hover:border-gray-100'}`}
                                        >
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <p className={`font-semibold text-sm ${selectedHospital?.name === hospital.name ? 'text-blue-700' : 'text-slate-800'}`}>{hospital.name}</p>
                                                    <p className="text-xs text-gray-500 mt-0.5">{hospital.location}</p>
                                                </div>
                                                <span className={`text-[10px] font-bold px-2 py-0.5 rounded ${hospital.type === 'Private' ? 'bg-purple-100 text-purple-600' : 'bg-green-100 text-green-700'}`}>{hospital.type}</span>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        {/* Detail Panel */}
                        <div className="lg:col-span-1">
                            <div className="sticky top-6 p-6 bg-slate-900 border border-slate-800 rounded-xl shadow-lg text-white h-fit">
                                {selectedHospital ? (
                                    <div className="space-y-5">
                                        <div>
                                            <h3 className="text-lg font-bold text-white leading-tight">{selectedHospital.name}</h3>
                                            <div className="flex items-center gap-2 text-xs text-slate-400 mt-2">
                                                <MapPin size={14} />
                                                {selectedHospital.location}, {selectedHospital.nation}
                                            </div>
                                            <div className="flex items-center gap-2 text-xs text-slate-400 mt-1">
                                                <Building2 size={14} />
                                                {selectedHospital.employer}
                                            </div>
                                        </div>

                                        <div className="pt-4 border-t border-slate-700">
                                            <strong className="text-blue-400 text-xs uppercase tracking-wider font-bold mb-3 block">Key Specialities</strong>
                                            <ul className="text-sm text-slate-300 space-y-2">
                                                {selectedHospital.specialties?.map(s => <li key={s} className="flex items-start gap-2"><div className="mt-1.5 w-1 h-1 rounded-full bg-blue-500 shrink-0"></div>{s}</li>) || <li className="italic text-slate-500">Information not available</li>}
                                            </ul>
                                        </div>

                                        <a 
                                            href={getJobLink(selectedHospital)} 
                                            target="_blank" 
                                            rel="noreferrer"
                                            className="mt-4 w-full flex justify-center items-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold text-sm shadow-lg shadow-blue-900/50 transition-all transform active:scale-95"
                                        >
                                            <ExternalLink size={16} />
                                            Visit Career Portal
                                        </a>
                                    </div>
                                ) : (
                                    <div className="text-center py-12 text-slate-500">
                                        <Building2 size={48} className="mx-auto mb-4 opacity-20" />
                                        <p className="text-sm">Select a hospital from the list to view details and access their job portal.</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
            </div>
        )}
      </div>
    </div>
  );
}

function EventsHub() {
    const [filter, setFilter] = useState('All');
    const [searchTerm, setSearchTerm] = useState('');
    
    // Extracted all unique event categories/types for the filter bar
    const allCategories = useMemo(() => {
        const categories = new Set();
        INITIAL_EVENTS.forEach(e => {
            categories.add(e.type);
            categories.add(e.category);
        });
        return ['All', ...Array.from(categories)].sort();
    }, []);

    const filteredEvents = useMemo(() => {
        const lowerCaseSearch = searchTerm.toLowerCase();
        
        return INITIAL_EVENTS
            .filter(event => {
                const categoryMatch = filter === 'All' || event.type === filter || event.category === filter;
                const searchMatch = !searchTerm || 
                                    event.title.toLowerCase().includes(lowerCaseSearch) ||
                                    event.organizer.toLowerCase().includes(lowerCaseSearch) ||
                                    event.location.toLowerCase().includes(lowerCaseSearch);
                return categoryMatch && searchMatch;
            })
            .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
    }, [filter, searchTerm]);

    const getStatusColor = (status) => {
        switch (status) {
            case 'Open': return 'text-emerald-700 bg-emerald-100';
            case 'Upcoming': return 'text-blue-700 bg-blue-100';
            case 'Full': return 'text-red-700 bg-red-100';
            case 'Past': return 'text-gray-600 bg-gray-200';
            default: return 'text-gray-600 bg-gray-100';
        }
    };

    return (
        <div className="space-y-6 animate-fade-in">
             <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 className="text-2xl font-bold text-slate-900">Events Hub: Database View</h2>
                <p className="text-gray-500">Browse and filter surgical conferences, courses, and exams.</p>
            </div>

            <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    {/* Search */}
                    <div className="relative md:col-span-2">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
                        <input
                            type="text"
                            placeholder="Search title, organizer, or location..."
                            className="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>
                    
                    {/* Filter */}
                    <select
                        value={filter}
                        onChange={(e) => setFilter(e.target.value)}
                        className="px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all"
                    >
                        {allCategories.map(cat => (
                            <option key={cat} value={cat}>{cat} Events</option>
                        ))}
                    </select>
                     <button className="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold text-sm hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                        <Plus size={16} /> Add Custom Event
                    </button>
                </div>
            </div>

            {/* List/Table View */}
            <div className="overflow-x-auto bg-white rounded-xl shadow-sm border border-gray-200">
                <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                        <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title / Organizer</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type / Category</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location</th>
                            <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">CPD</th>
                            <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Link</th>
                        </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-100">
                        {filteredEvents.length > 0 ? (
                            filteredEvents.map(event => (
                                <tr key={event.id} className="hover:bg-gray-50 transition-colors">
                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">
                                        {event.startDate}
                                        {event.startDate !== event.endDate && <div className="text-xs text-gray-500">to {event.endDate}</div>}
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap">
                                        <div className="text-sm font-semibold text-blue-700">{event.title}</div>
                                        <div className="text-xs text-gray-600">{event.organizer}</div>
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm">
                                        <TypeBadge type={event.type} />
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {event.location}
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-center">
                                        <span className="font-bold text-blue-600">{event.cpd}</span>
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-center">
                                        <span className={`inline-flex px-2 text-xs font-semibold leading-5 rounded-full ${getStatusColor(event.status)}`}>
                                            {event.status}
                                        </span>
                                    </td>
                                    <td className="px-6 py-4 whitespace-nowrap text-center">
                                        <a href={event.url} target="_blank" rel="noreferrer" className="text-blue-500 hover:text-blue-700">
                                            <ExternalLink size={16} className="inline" />
                                        </a>
                                    </td>
                                </tr>
                            ))
                        ) : (
                            <tr>
                                <td colSpan="7" className="px-6 py-8 text-center text-gray-400 text-sm">
                                    No events found matching the current filters.
                                </td>
                            </tr>
                        )}
                    </tbody>
                </table>
            </div>
        </div>
    );
}

function SpecialtyExplorerView() {
    const specialtiesData = [
        { name: "General Surgery", competition: "2.5:1", duration: "8 years", code: "GS", icon: <Syringe size={24} />, requirements: ["Full MRCS", "2 Core Surgical Years", "40+ Portfolio Points (competitive)"], pathway: ["CT1-2", "ST3-8 (General Surgery)", "Consultant"], keyProcedures: ["Laparoscopic Cholecystectomy", "Hernia Repair (Inguinal, Incisional)", "Appendicectomy"] },
        { name: "Trauma & Orthopaedics", competition: "4.5:1", duration: "8 years", code: "T&O", icon: <Bone size={24} />, requirements: ["Full MRCS", "Trauma and Orthopaedic Logbook", "National Presentation (minimum 1)"], pathway: ["CT1-2", "ST3-8 (T&O)", "Consultant"], keyProcedures: ["Internal Fixation of Fractures", "Joint Arthroplasty", "Arthroscopy"] },
        { name: "Urology", competition: "3.2:1", duration: "7 years", code: "URO", icon: <Droplet size={24} />, requirements: ["Full MRCS", "FRCS (Urol) in Specialty Training", "Endoscopy/Cystoscopy experience"], pathway: ["CT1-2", "ST3-7 (Urology)", "Consultant"], keyProcedures: ["Cystoscopy", "TURP/TURBT", "Nephrectomy"] },
        { name: "ENT (Otolaryngology)", competition: "2.8:1", duration: "7 years", code: "ENT", icon: <Ear size={24} />, requirements: ["Full MRCS or equivalent", "Head/Neck Anatomy knowledge", "Max 3 attempts at core surgery interview"], pathway: ["CT1-2", "ST3-7 (ENT)", "Consultant"], keyProcedures: ["Tonsillectomy", "Septoplasty", "Tracheostomy"] },
        { name: "Neurosurgery", competition: "9.0:1", duration: "8 years", code: "NS", icon: <Brain size={24} />, requirements: ["Neurosurgical Experience (Min 6 months)", "Academic/Research record (PhD/MD preferred)", "High Clinical score"], pathway: ["ST1-8 (Run-through)", "Consultant"], keyProcedures: ["Craniotomy for Trauma", "Shunt Insertion", "Spinal Decompression"] },
        { name: "Plastic Surgery", competition: "6.5:1", duration: "8 years", code: "PLA", icon: <Pencil size={24} />, requirements: ["Relevant publications (high impact)", "Microsurgery Course/Skills", "Elective in Plastics/Burns"], pathway: ["CT1-2", "ST3-8 (Plastics)", "Consultant"], keyProcedures: ["Flap Surgery", "Skin Grafting", "Microsurgical Anastomosis"] },
        { name: "Cardiothoracic", competition: "7.2:1", duration: "8 years", code: "CTS", icon: <Heart size={24} />, requirements: ["Cardiothoracic specific experience", "Research or Academic degree", "MRCS is desirable"], pathway: ["ST1-8 (Run-through)", "Consultant"], keyProcedures: ["Coronary Bypass", "Valve Repair/Replacement", "Lobectomy"] },
        { name: "OMFS (Maxillofacial)", competition: "1.5:1", duration: "7 years", code: "OMFS", icon: <GraduationCap size={24} />, requirements: ["Medical Degree (MBBS/MD) AND Dental Degree (BDS/DDS)", "Full MRCS"], pathway: ["Pre-ST", "ST3-7 (OMFS)", "Consultant"], keyProcedures: ["Facial Trauma Fixation", "Orthognathic Surgery", "Head & Neck Cancer Resection"] },
        { name: "Paediatric Surgery", competition: "5.5:1", duration: "7 years", code: "PAED", icon: <Baby size={24} />, requirements: ["MRCS (must)", "Paediatric experience (min 6 months)", "Logbook of Paediatric cases"], pathway: ["CT1-2", "ST3-7 (Paediatric Surgery)", "Consultant"], keyProcedures: ["Pyloromyotomy", "Herniotomy", "Neonatal Procedures"] },
        { name: "Vascular Surgery", competition: "2.1:1", duration: "8 years", code: "VAS", icon: <Zap size={24} />, requirements: ["MRCS (must)", "Vascular/Endovascular interest/experience", "Experience in Doppler/Ultrasound"], pathway: ["CT1-2", "ST3-8 (Vascular Surgery)", "Consultant"], keyProcedures: ["AAA Repair (Open & EVAR)", "Carotid Endarterectomy", "Amputations"] },
    ];
    
    const [selectedSpecialty, setSelectedSpecialty] = useState(null);

    // Detail Panel Component (defined locally for simplicity)
    const SpecialtyDetailPanel = ({ specialty, onClose }) => {
        if (!specialty) return null;
        
        const competitionColor = specialty.competition.startsWith('9') || specialty.competition.startsWith('8') || specialty.competition.startsWith('7') ? 'text-red-500' : 'text-emerald-500';

        return (
            <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fade-in">
                <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full h-5/6 overflow-y-auto p-8 relative">
                    <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100"><X size={20}/></button>

                    <div className="flex items-center gap-4 mb-6 border-b pb-4">
                        {React.cloneElement(specialty.icon, { size: 32, className: 'text-blue-600' })}
                        <h2 className="text-3xl font-bold text-slate-900">{specialty.name}</h2>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-blue-50 p-4 rounded-lg text-center"><p className="text-sm text-blue-600 font-medium">Competition Ratio</p><p className={`text-2xl font-bold ${competitionColor}`}>{specialty.competition}</p></div>
                        <div className="bg-blue-50 p-4 rounded-lg text-center"><p className="text-sm text-blue-600 font-medium">Training Duration</p><p className="text-2xl font-bold text-slate-900">{specialty.duration}</p></div>
                        <div className="bg-blue-50 p-4 rounded-lg text-center"><p className="text-sm text-blue-600 font-medium">Training Code</p><p className="text-2xl font-bold text-slate-900">{specialty.code}</p></div>
                    </div>
                    
                    <div className="space-y-8">
                        {/* Requirements */}
                        <div>
                            <h3 className="text-xl font-bold text-slate-800 mb-3 flex items-center gap-2"><ClipboardList size={20} className="text-blue-500"/> Key Entry Requirements</h3>
                            <ul className="space-y-2 text-gray-700 list-disc list-inside bg-gray-50 p-4 rounded-lg">
                                {specialty.requirements.map((req, idx) => <li key={idx} className="text-sm">{req}</li>)}
                            </ul>
                        </div>

                        {/* Pathway */}
                        <div>
                            <h3 className="text-xl font-bold text-slate-800 mb-3 flex items-center gap-2"><Milestone size={20} className="text-blue-500"/> Indicative Pathway</h3>
                            <div className="flex flex-wrap gap-2">
                                {specialty.pathway.map((step, idx) => (
                                    <div key={idx} className="flex items-center">
                                        <span className="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm font-semibold">{step}</span>
                                        {idx < specialty.pathway.length - 1 && <ChevronRight size={16} className="text-gray-400 mx-1" />}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Procedures */}
                        <div>
                            <h3 className="text-xl font-bold text-slate-800 mb-3 flex items-center gap-2"><Syringe size={20} className="text-blue-500"/> Key Procedures</h3>
                            <div className="flex flex-wrap gap-3">
                                {specialty.keyProcedures.map((proc, idx) => (
                                    <span key={idx} className="bg-emerald-50 text-emerald-700 text-sm px-3 py-1 rounded-full">{proc}</span>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="mt-8 pt-6 border-t border-gray-100 text-right">
                        <a 
                            href={`https://www.rcseng.ac.uk/careers-in-surgery/surgical-specialties/${specialty.code.toLowerCase().replace(/[^a-z0-9]/g, '-')}/`} 
                            target="_blank" 
                            rel="noreferrer"
                            className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-bold text-sm transition-colors shadow-sm inline-flex items-center gap-2"
                        >
                            RCS England Official Guide <ExternalLink size={16} />
                        </a>
                    </div>

                </div>
            </div>
        );
    }
    // End SpecialtyDetailPanel

    return (
        <div className="space-y-6 animate-fade-in">
             {selectedSpecialty && <SpecialtyDetailPanel specialty={selectedSpecialty} onClose={() => setSelectedSpecialty(null)} />}

             <div className="bg-gradient-to-r from-blue-900 to-indigo-900 p-8 rounded-xl text-white shadow-lg">
                <h2 className="text-3xl font-bold mb-2">Specialty Explorer</h2>
                <p className="text-blue-100 max-w-2xl">Explore the 10 surgical specialties. View competition ratios, training pathways, and essential portfolio requirements.</p>
             </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {specialtiesData.map((spec, idx) => (
                    <div 
                        key={idx} 
                        className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-all cursor-pointer group"
                        onClick={() => setSelectedSpecialty(spec)}
                    >
                        <div className="flex justify-between items-start mb-4">
                            <div className="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center text-blue-700 font-bold text-lg group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                {React.cloneElement(spec.icon, { size: 24, className: 'text-blue-600 group-hover:text-white' })}
                            </div>
                            <span className="text-xs font-bold bg-gray-100 text-gray-600 px-2 py-1 rounded">ST3+</span>
                        </div>
                        <h3 className="text-lg font-bold text-slate-900 mb-2">{spec.name}</h3>
                        <div className="space-y-2 text-sm text-gray-600">
                             <div className="flex justify-between">
                                 <span>Competition:</span>
                                 <span className="font-semibold text-slate-900">{spec.competition}</span>
                             </div>
                             <div className="flex justify-between">
                                 <span>Duration:</span>
                                 <span className="font-semibold text-slate-900">{spec.duration}</span>
                             </div>
                        </div>
                        <button onClick={(e) => {e.stopPropagation(); setSelectedSpecialty(spec);}} className="w-full mt-4 py-2 border border-blue-200 text-blue-600 rounded-lg text-sm font-semibold hover:bg-blue-50 transition-colors">View Profile</button>
                    </div>
                ))}
            </div>
        </div>
    );
}

function TrainingPathwayView() {
    // Extensive data for each pathway stage
    const pathwayData = [
        { 
            id: 1, 
            title: "Medical School", 
            subtitle: "Undergraduate Education (MBBS/MBChB)", 
            years: "5-6 Years", 
            color: "bg-slate-200", 
            isCurrent: false, 
            details: {
                focus: "Pre-clinical science, anatomical knowledge, broad clinical exposure, student research projects (SSCs).",
                exams: "Internal university exams, Prescribing Safety Assessment (PSA), Final Exams.",
                output: "Medical Degree (MBBS/MBChB), Provisional General Medical Council (GMC) Registration."
            }
        },
        { 
            id: 2, 
            title: "Foundation Training", 
            subtitle: "FY1 & FY2", 
            years: "2 Years", 
            color: "bg-emerald-100 border-emerald-300 text-emerald-800", 
            isCurrent: false, 
            details: {
                focus: "Acquiring fundamental clinical skills, ward management, acute care, developing professionalism and generic professional capabilities (GPCs).",
                exams: "Post-FY1 Sign-off for Full GMC Registration.",
                output: "Foundation Programme Certificate of Completion (FPCC), Full GMC Registration (post-FY1)."
            }
        },
        { 
            id: 3, 
            title: "Core Surgical Training", 
            subtitle: "CT1 & CT2 (The Portfolio Building Years)", 
            years: "2 Years", 
            color: "bg-blue-100 border-blue-300 text-blue-800", 
            isCurrent: true, 
            details: {
                focus: "Surgical specialty rotations, developing basic operative skills (under supervision), mandatory intercollegiate courses (BSS, ATLS, CCrISP), maximizing portfolio points (Audit, Teaching, Research, Publications).",
                exams: "Intercollegiate Membership of the Royal Colleges of Surgeons (MRCS) Parts A & B (essential for ST3 entry).",
                output: "Core Surgical Training Certificate of Completion (CSTCC) required to apply for ST3."
            }
        },
        { 
            id: 4, 
            title: "Specialty Training", 
            subtitle: "ST3 - ST8 (Higher Surgical Training)", 
            years: "6 Years", 
            color: "bg-indigo-50 border-indigo-200 text-indigo-700", 
            isCurrent: false, 
            details: {
                focus: "Intensive subspecialty focus, achieving independent operating competence, higher management, leadership, and teaching roles, gaining fellowship experience.",
                exams: "Intercollegiate Fellowship of the Royal Colleges of Surgeons (FRCS) in chosen specialty.",
                output: "Certificate of Completion of Training (CCT), Specialist Register entry."
            }
        },
        { 
            id: 5, 
            title: "Consultant", 
            subtitle: "Subspecialty or Generalist Practice", 
            years: "Lifelong", 
            color: "bg-purple-50 border-purple-200 text-purple-700", 
            isCurrent: false, 
            details: {
                focus: "Independent clinical practice, departmental management, service development, mentoring juniors, research oversight, continuous professional development (CPD).",
                exams: "Annual appraisal and 5-yearly GMC revalidation.",
                output: "Consultant Post, Revalidation Certificate."
            }
        },
    ];

    const [expandedStageId, setExpandedStageId] = useState(pathwayData.find(s => s.isCurrent)?.id || null);

    const toggleExpansion = (id) => {
        setExpandedStageId(prevId => (prevId === id ? null : id));
    };

    const DetailCard = ({ data }) => (
        <div className="bg-white p-6 rounded-xl shadow-inner border border-gray-100 mt-4 animate-fade-in transition-all duration-300">
            <h4 className="text-md font-bold text-blue-600 mb-3 uppercase tracking-wider">Focus & Milestones</h4>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div>
                    <strong className="text-slate-800 flex items-center gap-1 mb-1"><LayoutGrid size={16} className="text-purple-500" /> Key Focus</strong>
                    <p className="text-gray-600">{data.focus}</p>
                </div>
                <div>
                    <strong className="text-slate-800 flex items-center gap-1 mb-1"><FileText size={16} className="text-purple-500" /> Exams/Assessments</strong>
                    <p className="text-gray-600">{data.exams}</p>
                </div>
                <div>
                    <strong className="text-slate-800 flex items-center gap-1 mb-1"><Award size={16} className="text-purple-500" /> Key Output</strong>
                    <p className="text-gray-600">{data.output}</p>
                </div>
            </div>
        </div>
    );

    return (
        <div className="space-y-8 animate-fade-in p-4 md:p-8 bg-white rounded-xl shadow-sm border border-gray-200">
            <div className="text-center mb-12">
                <h2 className="text-3xl font-bold text-slate-900">Your Training Pathway</h2>
                <p className="text-gray-500 mt-2">Visualise your journey from medical school to consultancy. Click any stage for extensive details.</p>
            </div>

            <div className="max-w-4xl mx-auto relative">
                {/* Vertical Line */}
                <div className="absolute left-1/2 top-0 bottom-0 w-1 bg-gray-200 -translate-x-1/2 hidden md:block"></div>

                <div className="space-y-4 relative">
                    {pathwayData.map((stage, idx) => (
                        <React.Fragment key={stage.id}>
                            <div className={`flex flex-col md:flex-row items-start md:items-center gap-4 ${idx % 2 === 0 ? 'md:flex-row-reverse' : ''}`}>
                                
                                {/* Timeline Side Info (Desktop Only) */}
                                <div className="flex-1 w-full md:text-right hidden md:block">
                                    <div className={`${idx % 2 === 0 ? 'text-left' : 'text-right'}`}>
                                        <span className="text-sm font-bold text-gray-400 uppercase tracking-widest">{stage.years}</span>
                                    </div>
                                </div>
                                
                                {/* Timeline Dot */}
                                <div className={`relative z-10 w-10 h-10 rounded-full flex items-center justify-center border-4 bg-white ${stage.isCurrent ? 'border-blue-500 shadow-lg shadow-blue-200' : 'border-gray-200'}`}>
                                    {stage.isCurrent && <div className="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>}
                                </div>

                                {/* Main Card */}
                                <div 
                                    className={`flex-1 w-full cursor-pointer transition-shadow hover:shadow-lg ${idx % 2 === 0 ? 'md:mr-24' : 'md:ml-24'}`}
                                    onClick={() => toggleExpansion(stage.id)}
                                >
                                    <div className={`p-4 rounded-xl border relative ${stage.isCurrent ? 'ring-2 ring-blue-400 ring-offset-2' : ''} ${stage.color || 'bg-white border-gray-200 shadow-sm'}`}>
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <h3 className="font-bold text-lg">{stage.title}</h3>
                                                <p className="text-sm opacity-80">{stage.subtitle}</p>
                                            </div>
                                            <div className="text-blue-500 shrink-0">
                                                {expandedStageId === stage.id ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Expandable Details Row */}
                            {expandedStageId === stage.id && (
                                <div className={`w-full max-w-4xl mx-auto ${idx % 2 === 0 ? 'md:pr-12 md:pl-0' : 'md:pl-12 md:pr-0'}`}>
                                    <DetailCard data={stage.details} />
                                </div>
                            )}
                        </React.Fragment>
                    ))}
                </div>
            </div>
        </div>
    );
}

function PersonalDevelopmentView() {
    // Structure based on the provided image and core educational pillars
    const categories = [
        { 
            title: "Clinical & Professional Development", 
            icon: <Syringe size={24} className="text-emerald-600" />,
            description: "Gain hands-on experience and deepen your clinical understanding.",
            items: [
                { name: "Volunteering & Shadowing", detail: "Find opportunities in hospitals or clinics to gain practical experience and observe specialists in action.", link: "https://www.rcseng.ac.uk/careers-in-surgery/careers-support/shadowing/" },
                { name: "Clinical Seminars & Internships", detail: "Attend extra time to expand your knowledge and pursue voluntary internships for hands-on skills beyond the curriculum.", link: "https://www.rcseng.ac.uk/courses/" },
                { name: "Work Experience (CNA, EMT)", detail: "Obtain certifications like Certified Nursing Assistant or EMT to gain valuable front-line experience.", link: "https://www.nhs.uk/career-planning/career-explorer/" },
            ]
        },
        { 
            title: "Research & Academic Enrichment", 
            icon: <Microscope size={24} className="text-blue-600" />,
            description: "Develop analytical skills and contribute to the scientific community.",
            items: [
                { name: "Research Assistance & Publishing", detail: "Work on a research project to develop analytical skills and contribute scientific literature to hone communication skills.", link: "https://www.rcseng.ac.uk/research/" },
                { name: "Online Courses & Academic Competitions", detail: "Study hard on medical topics with online courses and test your knowledge in academic contexts.", link: "https://www.futurelearn.com/courses/subjects/medicine-courses" },
            ]
        },
        { 
            title: "Leadership & Community Engagement", 
            icon: <Users size={24} className="text-purple-600" />,
            description: "Develop your teaching, teamwork, and leadership abilities.",
            items: [
                { name: "Tutoring & Teaching", detail: "Tutor fellow students to reinforce your own knowledge and develop essential teaching skills for your surgical career.", link: "https://www.rcseng.ac.uk/careers-in-surgery/training-in-the-uk/teaching-and-training-opportunities/" },
                { name: "Student Government & Clubs", detail: "Join student government or academic leagues to develop leadership and teamwork skills.", link: "https://www.asit.org/" },
                { name: "Community Service", detail: "Participate in health awareness campaigns, or local initiatives to serve the public and understand community health needs.", link: "https://www.volunteering.org.uk/" },
            ]
        },
        { 
            title: "Personal & Well-being", 
            icon: <Heart size={24} className="text-pink-600" />,
            description: "Maintain a healthy work-life balance to ensure long-term success and prevent burnout.",
            items: [
                { name: "Sports & Physical Health", detail: "Engage in team sports to demonstrate teamwork and a commitment to physical and mental health.", link: "https://www.nhs.uk/live-well/exercise/" },
                { name: "Arts, Culture & Hobbies", detail: "Participate in artistic activities like music, drama, or writing to provide a creative outlet and improve mental well-being.", link: "https://www.mind.org.uk/" },
                { name: "Language Courses", detail: "Learn a new language to communicate with a broader range of patients and colleagues.", link: "https://www.duolingo.com/" },
            ]
        },
    ];

    const LinkButton = ({ text, link }) => (
        <a href={link} target="_blank" rel="noreferrer" className="text-xs text-blue-600 font-semibold hover:underline flex items-center gap-0.5 mt-1">
            {text} <ExternalLink size={12} />
        </a>
    );

    return (
        <div className="space-y-6 animate-fade-in">
            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 className="text-2xl font-bold text-slate-900 mb-2">Personal Development Guide</h2>
                <p className="text-gray-500">A curated guide to extracurricular activities that strengthen your profile, enhance your skills, and support your well-being throughout your surgical training.</p>
            </div>

            <div className="grid gap-6">
                {categories.map((category, index) => (
                    <div key={index} className="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                        <div className="flex items-center gap-3 mb-4 border-b pb-4">
                            {category.icon}
                            <div>
                                <h3 className="text-xl font-bold text-slate-800">{category.title}</h3>
                                <p className="text-sm text-gray-500">{category.description}</p>
                            </div>
                        </div>
                        
                        <div className="space-y-4">
                            {category.items.map((item, i) => (
                                <div key={i} className="py-2 border-l-4 border-blue-100 pl-4 hover:bg-gray-50 rounded-r-lg transition-colors">
                                    <h4 className="font-semibold text-slate-800">{item.name}</h4>
                                    <p className="text-sm text-gray-600">{item.detail}</p>
                                    <LinkButton text="Find local opportunities" link={item.link} />
                                </div>
                            ))}
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}

// --- NEW COMPONENT: Landing Page ---

function LandingPage({ onEnter }) {
  const [activeModal, setActiveModal] = useState(null);
  const [authMode, setAuthMode] = useState(null); // 'login' | 'signup' | null

  const contactLinks = [
    { name: "Email", value: "contact@yoursurgicalcareer.com", icon: <Mail size={20} className="text-white" />, bg: "bg-blue-500", link: "mailto:contact@yoursurgicalcareer.com" },
    { name: "LinkedIn", value: "Your Surgical Career Professional", icon: <Linkedin size={20} className="text-white" />, bg: "bg-[#0077b5]", link: "#" },
    { name: "Instagram", value: "@YourSurgicalCareer", icon: <Instagram size={20} className="text-white" />, bg: "bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500", link: "#" },
    { name: "YouTube", value: "Surgical Training Channel", icon: <Youtube size={20} className="text-white" />, bg: "bg-[#FF0000]", link: "#" },
    { name: "Pinterest", value: "Surgical Resources", icon: <Pin size={20} className="text-white" />, bg: "bg-[#E60023]", link: "#" },
  ];

  const handleAuthSubmit = (e) => {
    e.preventDefault();
    onEnter(); // Simulates successful auth for now
  };

  return (
    <div className="min-h-screen bg-slate-900 text-white flex flex-col font-sans selection:bg-teal-500/30">
      {/* Navbar Placeholder - Minimal */}
      <nav className="p-6 md:px-12 flex justify-between items-center opacity-80 hover:opacity-100 transition-opacity">
        <div className="text-xl md:text-2xl font-bold tracking-wide text-white flex items-center gap-3">
            <Activity size={24} className="text-teal-400" />
            YourSurgicalCareer.com
        </div>
        <div className="hidden md:flex gap-6 text-sm font-medium text-slate-300">
          <button onClick={() => setActiveModal('about')} className="hover:text-teal-400 transition-colors">About</button>
          <button onClick={() => setActiveModal('contact')} className="hover:text-teal-400 transition-colors">Contact</button>
        </div>
      </nav>

      {/* Hero Section */}
      <div className="flex-1 flex flex-col items-center justify-center text-center px-4 max-w-4xl mx-auto -mt-16 w-full">
        {!authMode ? (
            <>
                <h1 className="text-3xl md:text-5xl font-serif font-bold text-slate-200 mb-6 leading-tight tracking-tight animate-fade-in">
                  Redefining the Future of <br className="hidden md:block" />
                  <span className="text-white relative inline-block">
                    Surgical Training
                    <span className="absolute -bottom-2 left-0 w-full h-1 bg-teal-500 rounded-full opacity-80"></span>
                  </span>
                </h1>
                
                <p className="text-slate-400 text-base md:text-lg max-w-2xl mb-12 font-light leading-relaxed animate-fade-in">
                  Join us to revolutionize surgical training. Everything you need for your career as a surgeon, all in one place. Your specialty, conferences, exam dates, deadlines, and portfolio links. Collated for you.
                </p>

                <div className="flex flex-col sm:flex-row gap-4 w-full justify-center max-w-sm animate-fade-in">
                    <button 
                      onClick={() => setAuthMode('signup')}
                      className="flex-1 flex items-center justify-center px-8 py-3.5 font-bold text-slate-900 transition-all duration-200 bg-teal-400 rounded-lg hover:bg-teal-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-400 hover:-translate-y-0.5 shadow-lg shadow-teal-900/20"
                    >
                      Sign Up
                    </button>
                    <button 
                      onClick={() => setAuthMode('login')} 
                      className="flex-1 flex items-center justify-center px-8 py-3.5 font-bold text-white transition-all duration-200 bg-slate-800 border border-slate-700 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-700 hover:-translate-y-0.5"
                    >
                      Log In
                    </button>
                </div>

                <button 
                  onClick={onEnter}
                  className="mt-8 text-slate-500 hover:text-teal-400 font-medium text-sm transition-colors flex items-center gap-2 animate-fade-in group"
                >
                  <span>Continue as Guest / Admin</span>
                  <ChevronRight size={14} className="group-hover:translate-x-0.5 transition-transform" />
                </button>
            </>
        ) : (
            <div className="w-full max-w-md bg-slate-800/50 p-8 rounded-2xl border border-slate-700 backdrop-blur-sm animate-fade-in shadow-2xl">
                <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold text-white">{authMode === 'login' ? 'Welcome Back' : 'Create Account'}</h2>
                    <button onClick={() => setAuthMode(null)} className="text-slate-400 hover:text-white transition-colors"><X size={20}/></button>
                </div>
                
                {/* Mock Auth Form */}
                <form onSubmit={handleAuthSubmit} className="space-y-4 text-left">
                    <div>
                        <label className="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wider">Email Address</label>
                        <input type="email" className="w-full bg-slate-900/80 border border-slate-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all placeholder:text-slate-600" placeholder="name@hospital.nhs.uk" required />
                    </div>
                    <div>
                        <label className="block text-xs font-medium text-slate-400 mb-1.5 uppercase tracking-wider">Password</label>
                        <input type="password" className="w-full bg-slate-900/80 border border-slate-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all placeholder:text-slate-600" placeholder="••••••••" required />
                    </div>
                    
                    <button type="submit" className="w-full bg-teal-500 hover:bg-teal-400 text-slate-900 font-bold py-3.5 rounded-lg transition-all mt-4 hover:shadow-lg hover:shadow-teal-500/20 active:scale-[0.98]">
                        {authMode === 'login' ? 'Log In' : 'Create Account'}
                    </button>
                </form>

                <div className="mt-6 pt-6 border-t border-slate-700/50">
                    <p className="text-sm text-slate-400">
                        {authMode === 'login' ? "Don't have an account? " : "Already have an account? "}
                        <button onClick={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')} className="text-teal-400 hover:text-teal-300 font-semibold hover:underline transition-colors ml-1">
                            {authMode === 'login' ? 'Sign Up' : 'Log In'}
                        </button>
                    </p>
                </div>
            </div>
        )}
      </div>

      {/* Footer / Copyright */}
      <footer className="p-6 text-center text-slate-600 text-xs">
        &copy; 2025 Your Surgical Career. All rights reserved.
      </footer>

      {/* About Modal */}
      {activeModal === 'about' && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in">
           <div className="bg-slate-800 p-8 rounded-2xl max-w-2xl text-white relative border border-slate-700 shadow-2xl">
             <button onClick={() => setActiveModal(null)} className="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors"><X size={24} /></button>
             <h2 className="text-2xl font-bold mb-4 text-teal-400">About Your Surgical Career</h2>
             <div className="space-y-4 text-slate-300 leading-relaxed">
               <p>
                 <strong>Your Surgical Career</strong> is designed to be the comprehensive Career Management System for surgical trainees in the UK.
               </p>
               <p>
                 We aim to bridge the gap between the fragmented tools currently available to trainees—unifying logbooks, portfolios, recruitment platforms, and exam resources into a single, cohesive "Professional Operating System."
               </p>
               <p>
                 Why use this platform? It is the sole means to effectively consolidate your career data, track your readiness for competitive selection (ST3), and access a centralized directory of jobs and hospitals without navigating multiple disparate websites.
               </p>
               <p className="font-semibold text-white mt-4">
                 Streamline your training. Focus on your surgery.
               </p>
             </div>
           </div>
        </div>
      )}

      {/* Contact Modal */}
      {activeModal === 'contact' && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in">
           <div className="bg-slate-800 p-8 rounded-2xl max-w-lg w-full text-white relative border border-slate-700 shadow-2xl">
             <button onClick={() => setActiveModal(null)} className="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors"><X size={24} /></button>
             <h2 className="text-2xl font-bold mb-6 text-teal-400 text-center">Get in Touch</h2>
             <div className="grid gap-3">
               {contactLinks.map((item) => (
                 <a 
                   key={item.name} 
                   href={item.link}
                   target="_blank"
                   rel="noopener noreferrer"
                   className="flex items-center p-3 rounded-xl bg-slate-700/50 hover:bg-slate-700 border border-slate-600 hover:border-teal-500/50 transition-all group"
                 >
                   <div className={`w-8 h-8 rounded-full flex items-center justify-center shadow-sm shrink-0 ${item.bg}`}>
                     {React.cloneElement(item.icon, { size: 16 })}
                   </div>
                   <div className="ml-3 flex-1">
                     <h3 className="text-sm font-bold text-slate-200">{item.name}</h3>
                     <p className="text-xs text-slate-400 group-hover:text-teal-400 transition-colors truncate">{item.value}</p>
                   </div>
                   <ExternalLink size={16} className="text-slate-500 group-hover:text-teal-400" />
                 </a>
               ))}
             </div>
           </div>
        </div>
      )}
    </div>
  );
}

// --- MAIN APP COMPONENT ---

export default function App() {
    // Auth State
    const [isAuthenticated, setIsAuthenticated] = useState(false);

    // Dashboard State
    const [activeView, setActiveView] = useState('dashboard');
    const [activities, setActivities] = useState(INITIAL_ACTIVITIES);
    const [profileData, setProfileData] = useState(MOCK_PROFILE_DATA); 
    // FIX: Corrected reduce function syntax to correctly calculate totalPoints
    const totalPoints = activities.reduce((sum, act) => sum + act.points, 0);
    const activitiesCount = activities.length;

    const navItems = [
        { id: 'dashboard', label: 'Dashboard', icon: <LayoutDashboard size={20} /> },
        { id: 'portfolio', label: 'Portfolio', icon: <BookMarked size={20} /> },
        { id: 'events', label: 'Events & Resources', icon: <CalendarIcon size={20} /> },
        { id: 'jobs', label: 'Job Hunt', icon: <Briefcase size={20} /> }, 
        { id: 'specialties', label: 'Specialties', icon: <Microscope size={20} /> },
        { id: 'pathway', label: 'Pathway', icon: <Milestone size={20} /> },
        { id: 'personal-dev', label: 'Personal Dev', icon: <UserCircle size={20} /> }, 
        { id: 'contact', label: 'Contact', icon: <Mail size={20} /> },
    ];
    const secondaryNavItems = [
        { id: 'shop', label: 'Shop', icon: <ShoppingCart size={20} /> },
    ];

    const renderView = () => {
        switch (activeView) {
            case 'dashboard': return <DashboardView totalPoints={totalPoints} activitiesCount={activitiesCount} setActiveView={setActiveView} />;
            case 'portfolio': return <PortfolioView activities={activities} setActivities={setActivities} profileData={profileData} setProfileData={setProfileData} />;
            case 'events': return <EventsHub />; 
            case 'jobs': return <ExternalJobsView />; 
            case 'specialties': return <SpecialtyExplorerView />;
            case 'pathway': return <TrainingPathwayView />;
            case 'personal-dev': return <PersonalDevelopmentView />;
            case 'contact': return <ContactView />;
            case 'shop': return <PlaceholderView title="Shop" />;
            default: return <DashboardView totalPoints={totalPoints} activitiesCount={activitiesCount} setActiveView={setActiveView} />;
        }
    };

    // --- RENDER LOGIC ---
    if (!isAuthenticated) {
        return <LandingPage onEnter={() => setIsAuthenticated(true)} />;
    }

    return (
        <div className="flex h-screen bg-gray-50 font-sans text-slate-800 overflow-hidden">
            <style>
            {`
              .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
              .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
              .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
              .no-scrollbar::-webkit-scrollbar { display: none; }
              .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
            `}
            </style>
            {/* Sidebar - DARK THEME */}
            <aside className="hidden md:flex w-20 lg:w-64 flex-col bg-slate-900 border-r border-slate-800 z-20 shrink-0 text-slate-300">
                <div 
                    className="p-6 flex flex-col gap-2 border-b border-slate-800 cursor-pointer hover:bg-slate-800/50 transition-colors group"
                    onClick={() => setIsAuthenticated(false)}
                >
                    <div className="flex items-center gap-3">
                        <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/20 text-white group-hover:scale-105 transition-transform">
                            {/* Updated Brand Icon */}
                            <Activity size={20} />
                        </div>
                        <span className="font-bold text-lg tracking-tight hidden lg:block text-white leading-tight group-hover:text-blue-200 transition-colors">Your Surgical Career</span>
                    </div>
                    <p className="text-[10px] text-slate-500 hidden lg:block mt-1 font-medium uppercase tracking-wider">Redefining the Future of Surgical Training</p>
                </div>
                <nav className="flex-1 px-4 py-6 space-y-1.5 overflow-y-auto custom-scrollbar">
                    {navItems.map(item => (
                        <button key={item.id} onClick={() => setActiveView(item.id)} className={`w-full flex items-center justify-between px-3 py-2.5 rounded-lg transition-all group ${activeView === item.id ? 'bg-blue-600 text-white font-medium shadow-md shadow-blue-900/20' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                            <div className="flex items-center gap-3">{React.cloneElement(item.icon, { size: 18 })}<span className="hidden lg:block text-sm">{item.label}</span></div>
                            {activeView === item.id && <ChevronRight size={14} className="hidden lg:block opacity-50" />}
                        </button>
                    ))}
                    <div className="pt-4 border-t border-slate-800 mt-4 space-y-1.5">
                        {secondaryNavItems.map(item => (
                            <button key={item.id} onClick={() => setActiveView(item.id)} className={`w-full flex items-center justify-between px-3 py-2.5 rounded-lg transition-all ${activeView === item.id ? 'bg-blue-600 text-white font-medium' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <div className="flex items-center gap-3">{React.cloneElement(item.icon, { size: 18 })}<span className="hidden lg:block text-sm">{item.label}</span></div>
                            </button>
                        ))}
                    </div>
                </nav>
                <div className="p-4 border-t border-slate-800">
                    <div className="flex items-center gap-3 px-2">
                        <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-xs">AC</div>
                        <div className="hidden lg:block overflow-hidden">
                            <p className="text-sm font-medium text-white truncate">Dr. Alex Chen</p>
                            <p className="text-xs text-slate-500 truncate">CT1 Trainee</p>
                        </div>
                    </div>
                </div>
            </aside>

            {/* Main Content */}
            <main className="flex-1 flex flex-col h-full overflow-hidden relative bg-gray-50">
                {/* Mobile Header */}
                <header className="md:hidden h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 shrink-0 z-30">
                    <div 
                        className="flex items-center gap-2 cursor-pointer"
                        onClick={() => setIsAuthenticated(false)}
                    >
                         <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                             {/* Updated Brand Icon */}
                             <Activity size={18} />
                         </div>
                         <span className="font-bold text-lg text-white">YSC</span>
                    </div>
                    {/* Placeholder for Mobile Menu toggle (not implemented) */}
                    <button className="text-slate-400"><Menu size={24}/></button> 
                </header>

                {/* Top Bar (Desktop) */}
                <div className="hidden md:flex h-16 bg-white border-b border-gray-200 px-8 items-center justify-between shrink-0">
                    <div className="flex items-center text-sm text-gray-500 gap-2">
                        <span className="hover:text-blue-600 cursor-pointer">Home</span>
                        <ChevronRight size={14} />
                        <span className="font-medium text-slate-800 capitalize">{activeView.replace('-', ' ')}</span>
                    </div>
                    <div className="flex items-center gap-4">
                        <button className="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors relative">
                            <Bell size={20} />
                            <span className="absolute top-2 right-2.5 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                        </button>
                    </div>
                </div>

                <div className="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar">
                    {renderView()}
                </div>

                {/* Mobile Nav */}
                <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-2 py-3 flex justify-around items-center z-40 safe-area-pb">
                    {navItems.slice(0, 5).map(item => (
                        <button key={item.id} onClick={() => setActiveView(item.id)} className={`flex flex-col items-center gap-1 p-1 ${activeView === item.id ? 'text-blue-600' : 'text-gray-400'}`}>
                            {React.cloneElement(item.icon, { size: 20, strokeWidth: activeView === item.id ? 2.5 : 2 })}
                            <span className="text-[10px] font-medium">{item.label.split(' ')[0]}</span>
                        </button>
                    ))}
                </nav>
            </main>
        </div>
    );
}